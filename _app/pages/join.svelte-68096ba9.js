import{b as N,_ as A}from"../chunks/paths-16c013c9.js";import{S as J,i as U,s as G,j as P,m as D,o as I,x as v,u as k,v as R,e as $,t as K,k as q,l as C,J as z,c as y,a as H,g as O,d as h,n as L,b,H as T,f as j,w as B,A as F,r as Q}from"../chunks/vendor-7e45e1c8.js";import{N as W,G as X,S as Y}from"../chunks/Navbar-0f88e819.js";function M(f){let o,a;return o=new X({props:{streams:f[0]}}),{c(){P(o.$$.fragment)},l(e){D(o.$$.fragment,e)},m(e,m){I(o,e,m),a=!0},p(e,m){const i={};m&1&&(i.streams=e[0]),o.$set(i)},i(e){a||(v(o.$$.fragment,e),a=!0)},o(e){k(o.$$.fragment,e),a=!1},d(e){R(o,e)}}}function Z(f){let o,a,e,m,i,s,g,_,w;s=new W({props:{time:f[1]}}),s.$on("videoswitch",f[3]),s.$on("muteswitch",f[4]),s.$on("sourceswitch",f[5]);let t=f[0].length!==0&&M(f);return{c(){o=$("link"),a=$("link"),e=$("script"),m=K("let parcelRequire;"),i=q(),P(s.$$.fragment),g=q(),t&&t.c(),_=C(),this.h()},l(r){const n=z('[data-svelte="svelte-uncxtc"]',document.head);o=y(n,"LINK",{rel:!0,href:!0}),a=y(n,"LINK",{rel:!0,href:!0}),e=y(n,"SCRIPT",{});var u=H(e);m=O(u,"let parcelRequire;"),u.forEach(h),n.forEach(h),i=L(r),D(s.$$.fragment,r),g=L(r),t&&t.l(r),_=C(),this.h()},h(){b(o,"rel","icon"),b(o,"href",""+(N+"/favicon.png")),b(a,"rel","manifest"),b(a,"href",""+(N+"/manifest.json")),document.title="Join"},m(r,n){T(document.head,o),T(document.head,a),T(document.head,e),T(e,m),j(r,i,n),I(s,r,n),j(r,g,n),t&&t.m(r,n),j(r,_,n),w=!0},p(r,[n]){const u={};n&2&&(u.time=r[1]),s.$set(u),r[0].length!==0?t?(t.p(r,n),n&1&&v(t,1)):(t=M(r),t.c(),v(t,1),t.m(_.parentNode,_)):t&&(Q(),k(t,1,1,()=>{t=null}),B())},i(r){w||(v(s.$$.fragment,r),v(t),w=!0)},o(r){k(s.$$.fragment,r),k(t),w=!1},d(r){h(o),h(a),h(e),r&&h(i),R(s,r),r&&h(g),t&&t.d(r),r&&h(_)}}}function x(f,o,a){let e=[],m=0,i=[],s=[];return F(async()=>{const r=(await A(()=>import("../chunks/peerjs.min-8eb05041.js").then(function(l){return l.p}),["chunks/peerjs.min-8eb05041.js","chunks/vendor-7e45e1c8.js","assets/vendor-b8c56e4e.css"])).default;let n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});a(0,e=[n]);let u=new URL(window.location.href),p=new r(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),E=l=>{let c=p.call(l,n);return i=[...i,c.peer],a(2,s=[...s,c]),c.on("stream",d=>{e.map(V=>V.id).includes(d.id)||a(0,e=[...e,d])}),c},S=l=>{a(0,e=e.filter((c,d)=>i[d]!=l)),i=i.filter(c=>c!=l),a(2,s=s.filter(c=>c.peer!=l))};p.on("open",l=>{i=[l],E(u.searchParams.get("room"));let c=p.connect(u.searchParams.get("room"));c.on("data",d=>{switch(d.type){case"connect":E(d.data.peerId);break;case"disconnect":S(d.data.peerId);break}}),c.on("close",()=>{S(c.peer)}),window.onunload=window.onbeforeunload=()=>{c.close()},setInterval(()=>a(1,m++,m),1e3)}),p.on("call",l=>{i=[...i,l.peer],a(2,s=[...s,l]),l.answer(n),l.on("stream",c=>{e.map(d=>d.id).includes(c.id)||a(0,e=[...e,c])})}),p.on("connection",l=>l.close())}),[e,m,s,()=>e[0].getVideoTracks().forEach(t=>t.enabled=!t.enabled),()=>e[0].getAudioTracks().forEach(t=>t.enabled=!t.enabled),async t=>{let n=(t.detail.source==Y.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];e[0].getVideoTracks().forEach(u=>{u.stop(),e[0].removeTrack(u)}),e[0].addTrack(n),s.forEach(u=>u.peerConnection.getSenders().filter(p=>p.track.kind=="video").forEach(p=>p.replaceTrack(n)))}]}class ne extends J{constructor(o){super();U(this,o,x,Z,G,{})}}export{ne as default};
