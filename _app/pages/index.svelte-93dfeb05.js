import{b as j,_ as P}from"../chunks/paths-16c013c9.js";import{S as V,i as A,s as L,j as S,m as I,o as N,x as v,u as w,v as D,e as y,t as G,k as R,l as q,J as H,c as E,a as K,g as U,d,n as C,b as k,H as b,f as T,w as z,A as J,r as O}from"../chunks/vendor-7e45e1c8.js";import{N as B,G as F,S as Q}from"../chunks/Navbar-0f88e819.js";function M(m){let n,o;return n=new F({props:{streams:m[0]}}),{c(){S(n.$$.fragment)},l(e){I(n.$$.fragment,e)},m(e,c){N(n,e,c),o=!0},p(e,c){const f={};c&1&&(f.streams=e[0]),n.$set(f)},i(e){o||(v(n.$$.fragment,e),o=!0)},o(e){w(n.$$.fragment,e),o=!1},d(e){D(n,e)}}}function W(m){let n,o,e,c,f,i,_,p,g;i=new B({props:{time:m[1]}}),i.$on("videoswitch",m[3]),i.$on("muteswitch",m[4]),i.$on("sourceswitch",m[5]);let t=m[0].length!==0&&M(m);return{c(){n=y("link"),o=y("link"),e=y("script"),c=G("let parcelRequire;"),f=R(),S(i.$$.fragment),_=R(),t&&t.c(),p=q(),this.h()},l(r){const a=H('[data-svelte="svelte-tu3wcf"]',document.head);n=E(a,"LINK",{rel:!0,href:!0}),o=E(a,"LINK",{rel:!0,href:!0}),e=E(a,"SCRIPT",{});var l=K(e);c=U(l,"let parcelRequire;"),l.forEach(d),a.forEach(d),f=C(r),I(i.$$.fragment,r),_=C(r),t&&t.l(r),p=q(),this.h()},h(){k(n,"rel","icon"),k(n,"href",""+(j+"/favicon.png")),k(o,"rel","manifest"),k(o,"href",""+(j+"/manifest.json")),document.title="Home"},m(r,a){b(document.head,n),b(document.head,o),b(document.head,e),b(e,c),T(r,f,a),N(i,r,a),T(r,_,a),t&&t.m(r,a),T(r,p,a),g=!0},p(r,[a]){const l={};a&2&&(l.time=r[1]),i.$set(l),r[0].length!==0?t?(t.p(r,a),a&1&&v(t,1)):(t=M(r),t.c(),v(t,1),t.m(p.parentNode,p)):t&&(O(),w(t,1,1,()=>{t=null}),z())},i(r){g||(v(i.$$.fragment,r),v(t),g=!0)},o(r){w(i.$$.fragment,r),w(t),g=!1},d(r){d(n),d(o),d(e),r&&d(f),D(i,r),r&&d(_),t&&t.d(r),r&&d(p)}}}function X(m,n,o){let e=[],c=[],f=0,i=[];return J(async()=>{const r=(await P(()=>import("../chunks/peerjs.min-8eb05041.js").then(function(s){return s.p}),["chunks/peerjs.min-8eb05041.js","chunks/vendor-7e45e1c8.js","assets/vendor-b8c56e4e.css"])).default;let a=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});o(0,e=[a]);let l=[],h=new r(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}});h.on("open",s=>{console.log(s),c=[s],setInterval(()=>o(1,f++,f),1e3)}),h.on("call",s=>{c=[...c,s.peer],o(2,i=[...i,s]),s.answer(a),s.on("stream",u=>{e.map($=>$.id).includes(u.id)||(o(0,e=[...e,u]),console.log(s.peerConnection.getSenders()))})}),h.on("connection",s=>{s.on("open",()=>{l.forEach(u=>{u.send({type:"connect",data:{peerId:s.peer}})}),l.push(s)}),s.on("close",()=>{l=l.filter(u=>u!=s),o(0,e=e.filter((u,$)=>c[$]!=s.peer)),c=c.filter(u=>u!=s.peer),o(2,i=i.filter(u=>u.peer!=s.peer)),l.forEach(u=>{u.send({type:"disconnect",data:{peerId:s.peer}})})}),window.onunload=window.onbeforeunload=()=>{s.close()}})}),[e,f,i,()=>e[0].getVideoTracks().forEach(t=>t.enabled=!t.enabled),()=>e[0].getAudioTracks().forEach(t=>t.enabled=!t.enabled),async t=>{let a=(t.detail.source==Q.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];e[0].getVideoTracks().forEach(l=>{l.stop(),e[0].removeTrack(l)}),e[0].addTrack(a),i.forEach(l=>l.peerConnection.getSenders().filter(h=>h.track.kind=="video").forEach(h=>h.replaceTrack(a)))}]}class ee extends V{constructor(n){super();A(this,n,X,W,L,{})}}export{ee as default};
