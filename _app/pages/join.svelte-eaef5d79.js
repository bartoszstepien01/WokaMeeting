import{b as D,_ as U}from"../chunks/paths-16c013c9.js";import{S as G,i as K,s as z,j as I,m as R,o as q,x as v,u as b,v as C,e as E,t as H,k as L,l as M,J as O,c as j,a as B,g as F,d as p,n as V,b as T,H as y,f as $,w as Q,A as W,r as X}from"../chunks/vendor-fab53af6.js";import{N as Y,G as Z,S as x}from"../chunks/Navbar-f668013f.js";function A(d){let o,a;return o=new Z({props:{streams:d[0]}}),{c(){I(o.$$.fragment)},l(e){R(o.$$.fragment,e)},m(e,f){q(o,e,f),a=!0},p(e,f){const i={};f&1&&(i.streams=e[0]),o.$set(i)},i(e){a||(v(o.$$.fragment,e),a=!0)},o(e){b(o.$$.fragment,e),a=!1},d(e){C(o,e)}}}function ee(d){let o,a,e,f,i,s,w,h,g;s=new Y({props:{time:d[1]}}),s.$on("videoswitch",d[3]),s.$on("muteswitch",d[4]),s.$on("sourceswitch",d[5]);let t=d[0].length!==0&&A(d);return{c(){o=E("link"),a=E("link"),e=E("script"),f=H("let parcelRequire;"),i=L(),I(s.$$.fragment),w=L(),t&&t.c(),h=M(),this.h()},l(r){const n=O('[data-svelte="svelte-uncxtc"]',document.head);o=j(n,"LINK",{rel:!0,href:!0}),a=j(n,"LINK",{rel:!0,href:!0}),e=j(n,"SCRIPT",{});var l=B(e);f=F(l,"let parcelRequire;"),l.forEach(p),n.forEach(p),i=V(r),R(s.$$.fragment,r),w=V(r),t&&t.l(r),h=M(),this.h()},h(){T(o,"rel","icon"),T(o,"href",""+(D+"/favicon.png")),T(a,"rel","manifest"),T(a,"href",""+(D+"/manifest.json")),document.title="Join"},m(r,n){y(document.head,o),y(document.head,a),y(document.head,e),y(e,f),$(r,i,n),q(s,r,n),$(r,w,n),t&&t.m(r,n),$(r,h,n),g=!0},p(r,[n]){const l={};n&2&&(l.time=r[1]),s.$set(l),r[0].length!==0?t?(t.p(r,n),n&1&&v(t,1)):(t=A(r),t.c(),v(t,1),t.m(h.parentNode,h)):t&&(X(),b(t,1,1,()=>{t=null}),Q())},i(r){g||(v(s.$$.fragment,r),v(t),g=!0)},o(r){b(s.$$.fragment,r),b(t),g=!1},d(r){p(o),p(a),p(e),r&&p(i),C(s,r),r&&p(w),t&&t.d(r),r&&p(h)}}}function te(d,o,a){let e=[],f=0,i=[],s=[];return W(async()=>{const r=(await U(()=>import("../chunks/peerjs.min-873ec715.js").then(function(c){return c.p}),["chunks/peerjs.min-873ec715.js","chunks/vendor-fab53af6.js","assets/vendor-b8c56e4e.css"])).default;let n=window.prompt("Enter username: "),l=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});a(0,e=[{username:n,stream:l}]);let _=new URL(window.location.href),k=new r(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),S=(c,m="")=>{let u=k.call(c,l,{metadata:{username:n}});return i=[...i,u.peer],a(2,s=[...s,u]),u.on("stream",P=>{e.map(J=>J.stream.id).includes(P.id)||a(0,e=[...e,{username:m,stream:P}])}),u},N=c=>{a(0,e=e.filter((m,u)=>i[u]!=c)),i=i.filter(m=>m!=c),a(2,s=s.filter(m=>m.peer!=c))};k.on("open",c=>{i=[c],S(_.searchParams.get("room"));let m=k.connect(_.searchParams.get("room"),{metadata:{username:n}});m.on("data",u=>{switch(u.type){case"connect":S(u.data.peerId,u.data.username);break;case"disconnect":N(u.data.peerId);break;case"username":a(0,e[1].username=u.data.username,e);break}}),m.on("close",()=>{N(m.peer)}),window.onunload=window.onbeforeunload=()=>{m.close()},setInterval(()=>a(1,f++,f),1e3)}),k.on("call",c=>{i=[...i,c.peer],a(2,s=[...s,c]),c.answer(l),c.on("stream",m=>{e.map(u=>u.stream.id).includes(m.id)||a(0,e=[...e,{username:c.metadata.username,stream:m}])})}),k.on("connection",c=>c.close())}),[e,f,s,()=>e[0].stream.getVideoTracks().forEach(t=>t.enabled=!t.enabled),()=>e[0].stream.getAudioTracks().forEach(t=>t.enabled=!t.enabled),async t=>{let n=(t.detail.source==x.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];e[0].stream.getVideoTracks().forEach(l=>{l.stop(),e[0].stream.removeTrack(l)}),e[0].stream.addTrack(n),s.forEach(l=>l.peerConnection.getSenders().filter(_=>_.track.kind=="video").forEach(_=>_.replaceTrack(n)))}]}class se extends G{constructor(o){super();K(this,o,te,ee,z,{})}}export{se as default};
