import{b as O,_ as W}from"../chunks/paths-16c013c9.js";import{S as X,i as Y,s as Z,j as L,m as R,o as q,x as j,u as M,v as y,e as N,t as x,k as $,L as ee,c as A,a as B,g as se,d as b,n as U,b as C,H as I,f as G,w as re,A as ae,r as te}from"../chunks/vendor-ef7a3a0d.js";import{N as ne,C as oe,M as le,G as ce,S as me}from"../chunks/Members-dd352666.js";function F(n){let c,s;return c=new ce({props:{streams:n[2],sidePanelVisible:n[0]||n[1]}}),{c(){L(c.$$.fragment)},l(r){R(c.$$.fragment,r)},m(r,p){q(c,r,p),s=!0},p(r,p){const a={};p&4&&(a.streams=r[2]),p&3&&(a.sidePanelVisible=r[0]||r[1]),c.$set(a)},i(r){s||(j(c.$$.fragment,r),s=!0)},o(r){M(c.$$.fragment,r),s=!1},d(r){y(c,r)}}}function ie(n){let c,s,r,p,a,f,t,_,g,E,m,D,w,V;t=new ne({props:{time:n[3],peer:!0}}),t.$on("videoswitch",n[9]),t.$on("muteswitch",n[10]),t.$on("sourceswitch",n[11]),t.$on("chatswitch",n[12]),t.$on("membersswitch",n[13]);let o=n[2].length!==0&&F(n);return m=new oe({props:{visible:n[0],messages:n[6]}}),m.$on("close",n[14]),m.$on("messagesend",n[15]),w=new le({props:{visible:n[1],users:n[2]}}),w.$on("close",n[16]),{c(){c=N("link"),s=N("link"),r=N("script"),p=x("let parcelRequire;"),a=$(),f=N("div"),L(t.$$.fragment),_=$(),o&&o.c(),E=$(),L(m.$$.fragment),D=$(),L(w.$$.fragment),this.h()},l(e){const l=ee('[data-svelte="svelte-uncxtc"]',document.head);c=A(l,"LINK",{rel:!0,href:!0}),s=A(l,"LINK",{rel:!0,href:!0}),r=A(l,"SCRIPT",{});var P=B(r);p=se(P,"let parcelRequire;"),P.forEach(b),l.forEach(b),a=U(e),f=A(e,"DIV",{class:!0});var k=B(f);R(t.$$.fragment,k),_=U(k),o&&o.l(k),k.forEach(b),E=U(e),R(m.$$.fragment,e),D=U(e),R(w.$$.fragment,e),this.h()},h(){C(c,"rel","icon"),C(c,"href",""+(O+"/favicon.png")),C(s,"rel","manifest"),C(s,"href",""+(O+"/manifest.json")),document.title="Join",C(f,"class",g=""+((n[0]||n[1]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center"))},m(e,l){I(document.head,c),I(document.head,s),I(document.head,r),I(r,p),G(e,a,l),G(e,f,l),q(t,f,null),I(f,_),o&&o.m(f,null),G(e,E,l),q(m,e,l),G(e,D,l),q(w,e,l),V=!0},p(e,[l]){const P={};l&8&&(P.time=e[3]),t.$set(P),e[2].length!==0?o?(o.p(e,l),l&4&&j(o,1)):(o=F(e),o.c(),j(o,1),o.m(f,null)):o&&(te(),M(o,1,1,()=>{o=null}),re()),(!V||l&3&&g!==(g=""+((e[0]||e[1]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center")))&&C(f,"class",g);const k={};l&1&&(k.visible=e[0]),l&64&&(k.messages=e[6]),m.$set(k);const h={};l&2&&(h.visible=e[1]),l&4&&(h.users=e[2]),w.$set(h)},i(e){V||(j(t.$$.fragment,e),j(o),j(m.$$.fragment,e),j(w.$$.fragment,e),V=!0)},o(e){M(t.$$.fragment,e),M(o),M(m.$$.fragment,e),M(w.$$.fragment,e),V=!1},d(e){b(c),b(s),b(r),e&&b(a),e&&b(f),y(t),o&&o.d(),e&&b(E),y(m,e),e&&b(D),y(w,e)}}}function ue(n,c,s){let r=!1,p=!1,a=[],f=0,t=[],_=[],g=[],E,m="";return ae(async()=>{const J=(await W(()=>import("../chunks/peerjs.min-3810ccda.js").then(function(i){return i.p}),["chunks/peerjs.min-3810ccda.js","chunks/vendor-ef7a3a0d.js","assets/vendor-b8c56e4e.css"])).default;s(8,m=window.prompt("Enter username: "));let S=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});s(2,a=[{username:m,stream:S}]);let T=new URL(window.location.href),v=new J(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),K=(i,d="")=>{let u=v.call(i,S,{metadata:{username:m}});return s(4,t=[...t,u.peer]),s(5,_=[..._,u]),u.on("stream",H=>{a.map(Q=>Q.stream.id).includes(H.id)||s(2,a=[...a,{username:d,stream:H}])}),u},z=i=>{s(2,a=a.filter((d,u)=>t[u]!=i)),s(4,t=t.filter(d=>d!=i)),s(5,_=_.filter(d=>d.peer!=i))};v.on("open",i=>{s(4,t=[i]),K(T.searchParams.get("room"));let d=v.connect(T.searchParams.get("room"),{metadata:{username:m}});d.on("data",u=>{switch(u.type){case"connect":K(u.data.peerId,u.data.username);break;case"disconnect":z(u.data.peerId);break;case"username":s(2,a[1].username=u.data.username,a);break;case"message":s(6,g=[...g,{author:u.data.author,message:u.data.message,id:u.data.id,me:!1}]);break}}),d.on("close",()=>{z(d.peer)}),window.onunload=window.onbeforeunload=()=>{d.close()},s(7,E=d),setInterval(()=>s(3,f++,f),1e3)}),v.on("call",i=>{s(4,t=[...t,i.peer]),s(5,_=[..._,i]),i.answer(S),i.on("stream",d=>{a.map(u=>u.stream.id).includes(d.id)||s(2,a=[...a,{username:i.metadata.username,stream:d}])})}),v.on("connection",i=>i.close())}),[r,p,a,f,t,_,g,E,m,()=>a[0].stream.getVideoTracks().forEach(h=>h.enabled=!h.enabled),()=>a[0].stream.getAudioTracks().forEach(h=>h.enabled=!h.enabled),async h=>{let S=(h.detail.source==me.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];a[0].stream.getVideoTracks().forEach(T=>{T.stop(),a[0].stream.removeTrack(T)}),a[0].stream.addTrack(S),_.forEach(T=>T.peerConnection.getSenders().filter(v=>v.track.kind=="video").forEach(v=>v.replaceTrack(S)))},()=>{s(0,r=!r),s(1,p=!1)},()=>{s(1,p=!p),s(0,r=!1)},()=>s(0,r=!1),h=>{E.send({type:"message",data:{message:h.detail.message}}),s(6,g=[...g,{author:m,message:h.detail.message,id:t[0],me:!0}])},()=>s(1,p=!1)]}class pe extends X{constructor(c){super();Y(this,c,ue,ie,Z,{})}}export{pe as default};
