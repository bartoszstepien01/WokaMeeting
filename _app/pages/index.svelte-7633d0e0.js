import{b as O,_ as Y}from"../chunks/paths-16c013c9.js";import{S as H,i as U,s as z,j as G,m as L,o as N,x as V,u as D,v as A,e as T,k as q,t as J,c as j,a as K,n as C,g as B,d as _,J as F,b,f as R,H as w,h as Z,K as x,L as ee,M as se,w as te,A as ae,r as re}from"../chunks/vendor-d3715cf7.js";import{P as le,N as ne,C as ie,G as oe,S as ce}from"../chunks/Chat-29b8aba7.js";function Q(n,t,s){const e=n.slice();return e[3]=t[s],e}function W(n){let t,s,e,r,c,a,i=n[3].username+"",g,v;return{c(){t=T("div"),s=T("img"),c=q(),a=T("p"),g=J(i),v=q(),this.h()},l(d){t=j(d,"DIV",{class:!0});var m=K(t);s=j(m,"IMG",{src:!0,alt:!0,class:!0}),c=C(m),a=j(m,"P",{class:!0});var k=K(a);g=B(k,i),k.forEach(_),v=C(m),m.forEach(_),this.h()},h(){F(s.src,e="https://avatars.dicebear.com/api/initials/"+n[3].username+".svg")||b(s,"src",e),b(s,"alt",r=n[3].username),b(s,"class","rounded-md w-12 h-12 mt-auto"),b(a,"class","text-white"),b(t,"class","flex gap-2 flex-row items-center")},m(d,m){R(d,t,m),w(t,s),w(t,c),w(t,a),w(a,g),w(t,v)},p(d,m){m&2&&!F(s.src,e="https://avatars.dicebear.com/api/initials/"+d[3].username+".svg")&&b(s,"src",e),m&2&&r!==(r=d[3].username)&&b(s,"alt",r),m&2&&i!==(i=d[3].username+"")&&Z(g,i)},d(d){d&&_(t)}}}function me(n){let t,s=n[1],e=[];for(let r=0;r<s.length;r+=1)e[r]=W(Q(n,s,r));return{c(){t=T("div");for(let r=0;r<e.length;r+=1)e[r].c();this.h()},l(r){t=j(r,"DIV",{class:!0});var c=K(t);for(let a=0;a<e.length;a+=1)e[a].l(c);c.forEach(_),this.h()},h(){b(t,"class","flex flex-col h-auto flex-1 gap-6")},m(r,c){R(r,t,c);for(let a=0;a<e.length;a+=1)e[a].m(t,null)},p(r,c){if(c&2){s=r[1];let a;for(a=0;a<s.length;a+=1){const i=Q(r,s,a);e[a]?e[a].p(i,c):(e[a]=W(i),e[a].c(),e[a].m(t,null))}for(;a<e.length;a+=1)e[a].d(1);e.length=s.length}},d(r){r&&_(t),x(e,r)}}}function ue(n){let t,s;return t=new le({props:{title:"Members",visible:n[0],$$slots:{default:[me]},$$scope:{ctx:n}}}),t.$on("close",n[2]),{c(){G(t.$$.fragment)},l(e){L(t.$$.fragment,e)},m(e,r){N(t,e,r),s=!0},p(e,[r]){const c={};r&1&&(c.visible=e[0]),r&66&&(c.$$scope={dirty:r,ctx:e}),t.$set(c)},i(e){s||(V(t.$$.fragment,e),s=!0)},o(e){D(t.$$.fragment,e),s=!1},d(e){A(t,e)}}}function fe(n,t,s){let{visible:e}=t,{users:r}=t;function c(a){ee.call(this,n,a)}return n.$$set=a=>{"visible"in a&&s(0,e=a.visible),"users"in a&&s(1,r=a.users)},[e,r,c]}class he extends H{constructor(t){super();U(this,t,fe,ue,z,{visible:0,users:1})}}function X(n){let t,s;return t=new oe({props:{streams:n[0],sidePanelVisible:n[6]}}),{c(){G(t.$$.fragment)},l(e){L(t.$$.fragment,e)},m(e,r){N(t,e,r),s=!0},p(e,r){const c={};r&1&&(c.streams=e[0]),r&64&&(c.sidePanelVisible=e[6]),t.$set(c)},i(e){s||(V(t.$$.fragment,e),s=!0)},o(e){D(t.$$.fragment,e),s=!1},d(e){A(t,e)}}}function de(n){let t,s,e,r,c,a,i,g,v,d,m,k,$,P;i=new ne({props:{time:n[2]}}),i.$on("videoswitch",n[9]),i.$on("muteswitch",n[10]),i.$on("sourceswitch",n[11]),i.$on("chatswitch",n[12]),i.$on("membersswitch",n[13]);let u=n[0].length!==0&&X(n);return m=new ie({props:{visible:n[6],messages:n[5]}}),m.$on("close",n[14]),m.$on("messagesend",n[15]),$=new he({props:{visible:n[7],users:n[0]}}),{c(){t=T("link"),s=T("link"),e=T("script"),r=J("let parcelRequire;"),c=q(),a=T("div"),G(i.$$.fragment),g=q(),u&&u.c(),d=q(),G(m.$$.fragment),k=q(),G($.$$.fragment),this.h()},l(l){const f=se('[data-svelte="svelte-tu3wcf"]',document.head);t=j(f,"LINK",{rel:!0,href:!0}),s=j(f,"LINK",{rel:!0,href:!0}),e=j(f,"SCRIPT",{});var M=K(e);r=B(M,"let parcelRequire;"),M.forEach(_),f.forEach(_),c=C(l),a=j(l,"DIV",{class:!0});var h=K(a);L(i.$$.fragment,h),g=C(h),u&&u.l(h),h.forEach(_),d=C(l),L(m.$$.fragment,l),k=C(l),L($.$$.fragment,l),this.h()},h(){b(t,"rel","icon"),b(t,"href",""+(O+"/favicon.png")),b(s,"rel","manifest"),b(s,"href",""+(O+"/manifest.json")),document.title="Home",b(a,"class",v=""+((n[6]?"hidden":"flex")+" md:flex flex-col h-screen w-screen items-center"))},m(l,f){w(document.head,t),w(document.head,s),w(document.head,e),w(e,r),R(l,c,f),R(l,a,f),N(i,a,null),w(a,g),u&&u.m(a,null),R(l,d,f),N(m,l,f),R(l,k,f),N($,l,f),P=!0},p(l,[f]){const M={};f&4&&(M.time=l[2]),i.$set(M),l[0].length!==0?u?(u.p(l,f),f&1&&V(u,1)):(u=X(l),u.c(),V(u,1),u.m(a,null)):u&&(re(),D(u,1,1,()=>{u=null}),te()),(!P||f&64&&v!==(v=""+((l[6]?"hidden":"flex")+" md:flex flex-col h-screen w-screen items-center")))&&b(a,"class",v);const h={};f&64&&(h.visible=l[6]),f&32&&(h.messages=l[5]),m.$set(h);const E={};f&128&&(E.visible=l[7]),f&1&&(E.users=l[0]),$.$set(E)},i(l){P||(V(i.$$.fragment,l),V(u),V(m.$$.fragment,l),V($.$$.fragment,l),P=!0)},o(l){D(i.$$.fragment,l),D(u),D(m.$$.fragment,l),D($.$$.fragment,l),P=!1},d(l){_(t),_(s),_(e),l&&_(c),l&&_(a),A(i),u&&u.d(),l&&_(d),A(m,l),l&&_(k),A($,l)}}}function pe(n,t,s){let e=[],r=[],c=0,a=[],i=[],g=[],v=!1,d=!1,m="";return ae(async()=>{const E=(await Y(()=>import("../chunks/peerjs.min-58d006d4.js").then(function(o){return o.p}),["chunks/peerjs.min-58d006d4.js","chunks/vendor-d3715cf7.js","assets/vendor-b8c56e4e.css"])).default;s(8,m="DeathGuard12");let y=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});s(0,e=[{username:m,stream:y}]);let I=new E(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}});I.on("open",o=>{console.log(o),s(1,r=[o]),setInterval(()=>s(2,c++,c),1e3)}),I.on("call",o=>{s(1,r=[...r,o.peer]),s(3,a=[...a,o]),o.answer(y),o.on("stream",p=>{e.map(S=>S.stream.id).includes(p.id)||s(0,e=[...e,{username:o.metadata.username,stream:p}])})}),I.on("connection",o=>{o.on("open",()=>{i.forEach(p=>{p.send({type:"connect",data:{peerId:o.peer,username:o.metadata.username}})}),o.send({type:"username",data:{username:m}}),i.push(o)}),o.on("close",()=>{s(4,i=i.filter(p=>p!=o)),s(0,e=e.filter((p,S)=>r[S]!=o.peer)),s(1,r=r.filter(p=>p!=o.peer)),s(3,a=a.filter(p=>p.peer!=o.peer)),i.forEach(p=>{p.send({type:"disconnect",data:{peerId:o.peer}})})}),o.on("data",p=>{switch(p.type){case"message":i.forEach(S=>{S.peer!=o.peer&&S.send({type:"message",data:{author:e[i.indexOf(o)].username,message:p.data.message,id:o.peer}})}),s(5,g=[...g,{author:e[i.indexOf(o)].username,message:p.data.message,id:o.peer,me:!1}]);break}}),window.onunload=window.onbeforeunload=()=>{o.close()}})}),[e,r,c,a,i,g,v,d,m,()=>e[0].stream.getVideoTracks().forEach(h=>h.enabled=!h.enabled),()=>e[0].stream.getAudioTracks().forEach(h=>h.enabled=!h.enabled),async h=>{let y=(h.detail.source==ce.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];e[0].stream.getVideoTracks().forEach(I=>{I.stop(),e[0].stream.removeTrack(I)}),e[0].stream.addTrack(y),a.forEach(I=>I.peerConnection.getSenders().filter(o=>o.track.kind=="video").forEach(o=>o.replaceTrack(y)))},()=>s(6,v=!v),()=>s(7,d=!d),()=>s(6,v=!1),h=>{i.forEach(E=>{E.send({type:"message",data:{author:m,message:h.detail.message,id:r[0]}})}),s(5,g=[...g,{author:m,message:h.detail.message,id:r[0],me:!0}])}]}class ve extends H{constructor(t){super();U(this,t,pe,de,z,{})}}export{ve as default};
