import{b as y,_ as R}from"../chunks/paths-16c013c9.js";import{S as q,i as E,s as I,j as L,m as S,o as x,x as _,u as k,v as G,e as w,t as J,k as N,l as j,J as A,c as b,a as C,g as D,d as u,n as K,b as h,H as g,f as $,w as M,A as T,r as U}from"../chunks/vendor-07f555be.js";import{G as z}from"../chunks/Gallery-3b700d69.js";function P(m){let n,a;return n=new z({props:{streams:m[0]}}),{c(){L(n.$$.fragment)},l(e){S(n.$$.fragment,e)},m(e,o){x(n,e,o),a=!0},p(e,o){const l={};o&1&&(l.streams=e[0]),n.$set(l)},i(e){a||(_(n.$$.fragment,e),a=!0)},o(e){k(n.$$.fragment,e),a=!1},d(e){G(n,e)}}}function H(m){let n,a,e,o,l,i,c,t=m[0].length!==0&&P(m);return{c(){n=w("link"),a=w("link"),e=w("script"),o=J("let parcelRequire;"),l=N(),t&&t.c(),i=j(),this.h()},l(r){const s=A('[data-svelte="svelte-uncxtc"]',document.head);n=b(s,"LINK",{rel:!0,href:!0}),a=b(s,"LINK",{rel:!0,href:!0}),e=b(s,"SCRIPT",{});var f=C(e);o=D(f,"let parcelRequire;"),f.forEach(u),s.forEach(u),l=K(r),t&&t.l(r),i=j(),this.h()},h(){h(n,"rel","icon"),h(n,"href",""+(y+"/favicon.png")),h(a,"rel","manifest"),h(a,"href",""+(y+"/manifest.json")),document.title="Join"},m(r,s){g(document.head,n),g(document.head,a),g(document.head,e),g(e,o),$(r,l,s),t&&t.m(r,s),$(r,i,s),c=!0},p(r,[s]){r[0].length!==0?t?(t.p(r,s),s&1&&_(t,1)):(t=P(r),t.c(),_(t,1),t.m(i.parentNode,i)):t&&(U(),k(t,1,1,()=>{t=null}),M())},i(r){c||(_(t),c=!0)},o(r){k(t),c=!1},d(r){u(n),u(a),u(e),r&&u(l),t&&t.d(r),r&&u(i)}}}function O(m,n,a){let e=[],o=[];return T(async()=>{const i=(await R(()=>import("../chunks/peerjs.min-90eb8cad.js").then(function(s){return s.p}),["chunks/peerjs.min-90eb8cad.js","chunks/vendor-07f555be.js"])).default;let c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});a(0,e=[c]);let t=new URL(window.location.href),r=new i(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}});r.on("open",s=>{o=[s];let f=r.call(t.searchParams.get("room"),c);o=[...o,f.peer],f.on("stream",p=>{e.map(v=>v.id).includes(p.id)||a(0,e=[...e,p])});let d=r.connect(t.searchParams.get("room"));d.on("close",()=>{a(0,e=e.filter((p,v)=>o[v]!=d.peer)),o=o.filter(p=>p!=d.peer)}),window.onunload=window.onbeforeunload=()=>{d.close()}})}),[e]}class Q extends q{constructor(n){super();E(this,n,O,H,I,{})}}export{Q as default};
