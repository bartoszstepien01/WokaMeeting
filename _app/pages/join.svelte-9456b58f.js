import{b as y,_ as R}from"../chunks/paths-16c013c9.js";import{S as q,i as E,s as L,j as S,m as x,o as C,x as h,u as w,v as G,e as b,t as J,k as N,l as j,J as T,c as v,a as A,g as D,d as p,n as K,b as g,H as k,f as $,w as M,A as U,r as z}from"../chunks/vendor-07f555be.js";import{G as H}from"../chunks/Gallery-e95ffafa.js";function P(d){let r,a;return r=new H({props:{streams:d[0]}}),{c(){S(r.$$.fragment)},l(e){x(r.$$.fragment,e)},m(e,s){C(r,e,s),a=!0},p(e,s){const u={};s&1&&(u.streams=e[0]),r.$set(u)},i(e){a||(h(r.$$.fragment,e),a=!0)},o(e){w(r.$$.fragment,e),a=!1},d(e){G(r,e)}}}function O(d){let r,a,e,s,u,f,m,t=d[0].length!==0&&P(d);return{c(){r=b("link"),a=b("link"),e=b("script"),s=J("let parcelRequire;"),u=N(),t&&t.c(),f=j(),this.h()},l(n){const o=T('[data-svelte="svelte-uncxtc"]',document.head);r=v(o,"LINK",{rel:!0,href:!0}),a=v(o,"LINK",{rel:!0,href:!0}),e=v(o,"SCRIPT",{});var _=A(e);s=D(_,"let parcelRequire;"),_.forEach(p),o.forEach(p),u=K(n),t&&t.l(n),f=j(),this.h()},h(){g(r,"rel","icon"),g(r,"href",""+(y+"/favicon.png")),g(a,"rel","manifest"),g(a,"href",""+(y+"/manifest.json")),document.title="Join"},m(n,o){k(document.head,r),k(document.head,a),k(document.head,e),k(e,s),$(n,u,o),t&&t.m(n,o),$(n,f,o),m=!0},p(n,[o]){n[0].length!==0?t?(t.p(n,o),o&1&&h(t,1)):(t=P(n),t.c(),h(t,1),t.m(f.parentNode,f)):t&&(z(),w(t,1,1,()=>{t=null}),M())},i(n){m||(h(t),m=!0)},o(n){w(t),m=!1},d(n){p(r),p(a),p(e),n&&p(u),t&&t.d(n),n&&p(f)}}}function V(d,r,a){let e=[],s=[];return U(async()=>{const f=(await R(()=>import("../chunks/peerjs.min-90eb8cad.js").then(function(l){return l.p}),["chunks/peerjs.min-90eb8cad.js","chunks/vendor-07f555be.js"])).default;let m=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});a(0,e=[m]);let t=new URL(window.location.href),n=new f(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),o=l=>{let c=n.call(l,m);return s=[...s,c.peer],c.on("stream",i=>{e.map(I=>I.id).includes(i.id)||a(0,e=[...e,i])}),c},_=l=>{a(0,e=e.filter((c,i)=>s[i]!=l)),s=s.filter(c=>c!=l)};n.on("open",l=>{s=[l],o(t.searchParams.get("room"));let c=n.connect(t.searchParams.get("room"));c.on("data",i=>{switch(i.type){case"connect":o(i.data.peerId);break;case"disconnect":_(i.data.peerId);break}}),c.on("close",()=>{_(c.peer)}),window.onunload=window.onbeforeunload=()=>{c.close()}}),n.on("call",l=>{s=[...s,l.peer],l.answer(m),l.on("stream",c=>{e.map(i=>i.id).includes(c.id)||a(0,e=[...e,c])})}),n.on("connection",l=>l.close())}),[e]}class W extends q{constructor(r){super();E(this,r,V,O,L,{})}}export{W as default};
