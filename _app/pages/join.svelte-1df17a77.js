import{b as U,_ as F}from"../chunks/paths-16c013c9.js";import{S as Q,i as W,s as X,j as D,m as I,o as N,L as Y,x as g,u as $,v as J,e as T,t as Z,k as L,M as x,c as A,a as G,g as ee,d as b,n as R,b as S,H as q,f as C,w as K,A as se,N as ne,O as re,r as O}from"../chunks/vendor-775b6d8d.js";import{N as te,C as ae,M as ie,J as oe,G as le,S as fe}from"../chunks/JoinPopup-c71c7599.js";function H(t){let a,r,s;function d(n){t[8](n)}let c={};return t[7]!==void 0&&(c.promise=t[7]),a=new oe({props:c}),ne.push(()=>re(a,"promise",d)),{c(){D(a.$$.fragment)},l(n){I(a.$$.fragment,n)},m(n,m){N(a,n,m),s=!0},p(n,m){const f={};!r&&m&128&&(r=!0,f.promise=n[7],Y(()=>r=!1)),a.$set(f)},i(n){s||(g(a.$$.fragment,n),s=!0)},o(n){$(a.$$.fragment,n),s=!1},d(n){J(a,n)}}}function y(t){let a,r;return a=new le({props:{streams:t[3],sidePanelVisible:t[1]||t[2]}}),{c(){D(a.$$.fragment)},l(s){I(a.$$.fragment,s)},m(s,d){N(a,s,d),r=!0},p(s,d){const c={};d&8&&(c.streams=s[3]),d&6&&(c.sidePanelVisible=s[1]||s[2]),a.$set(c)},i(s){r||(g(a.$$.fragment,s),r=!0)},o(s){$(a.$$.fragment,s),r=!1},d(s){J(a,s)}}}function me(t){let a,r,s,d,c,n,m,f,k,v,j,h,V,w,P,o=t[6]==null&&H(t);f=new te({props:{time:t[4],peer:!0}}),f.$on("videoswitch",t[9]),f.$on("muteswitch",t[10]),f.$on("sourceswitch",t[11]),f.$on("chatswitch",t[12]),f.$on("membersswitch",t[13]);let l=t[3].length!==0&&y(t);return h=new ae({props:{visible:t[1],messages:t[5]}}),h.$on("close",t[14]),h.$on("messagesend",t[15]),w=new ie({props:{visible:t[2],users:t[3]}}),w.$on("close",t[16]),{c(){a=T("link"),r=T("link"),s=T("script"),d=Z("let parcelRequire;"),c=L(),o&&o.c(),n=L(),m=T("div"),D(f.$$.fragment),k=L(),l&&l.c(),j=L(),D(h.$$.fragment),V=L(),D(w.$$.fragment),this.h()},l(e){const i=x('[data-svelte="svelte-uncxtc"]',document.head);a=A(i,"LINK",{rel:!0,href:!0}),r=A(i,"LINK",{rel:!0,href:!0}),s=A(i,"SCRIPT",{});var u=G(s);d=ee(u,"let parcelRequire;"),u.forEach(b),i.forEach(b),c=R(e),o&&o.l(e),n=R(e),m=A(e,"DIV",{class:!0});var p=G(m);I(f.$$.fragment,p),k=R(p),l&&l.l(p),p.forEach(b),j=R(e),I(h.$$.fragment,e),V=R(e),I(w.$$.fragment,e),this.h()},h(){S(a,"rel","icon"),S(a,"href",""+(U+"/favicon.png")),S(r,"rel","manifest"),S(r,"href",""+(U+"/manifest.json")),document.title="Join",S(m,"class",v=""+((t[1]||t[2]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center"))},m(e,i){q(document.head,a),q(document.head,r),q(document.head,s),q(s,d),C(e,c,i),o&&o.m(e,i),C(e,n,i),C(e,m,i),N(f,m,null),q(m,k),l&&l.m(m,null),C(e,j,i),N(h,e,i),C(e,V,i),N(w,e,i),P=!0},p(e,[i]){e[6]==null?o?(o.p(e,i),i&64&&g(o,1)):(o=H(e),o.c(),g(o,1),o.m(n.parentNode,n)):o&&(O(),$(o,1,1,()=>{o=null}),K());const u={};i&16&&(u.time=e[4]),f.$set(u),e[3].length!==0?l?(l.p(e,i),i&8&&g(l,1)):(l=y(e),l.c(),g(l,1),l.m(m,null)):l&&(O(),$(l,1,1,()=>{l=null}),K()),(!P||i&6&&v!==(v=""+((e[1]||e[2]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center")))&&S(m,"class",v);const p={};i&2&&(p.visible=e[1]),i&32&&(p.messages=e[5]),h.$set(p);const E={};i&4&&(E.visible=e[2]),i&8&&(E.users=e[3]),w.$set(E)},i(e){P||(g(o),g(f.$$.fragment,e),g(l),g(h.$$.fragment,e),g(w.$$.fragment,e),P=!0)},o(e){$(o),$(f.$$.fragment,e),$(l),$(h.$$.fragment,e),$(w.$$.fragment,e),P=!1},d(e){b(a),b(r),b(s),e&&b(c),o&&o.d(e),e&&b(n),e&&b(m),J(f),l&&l.d(),e&&b(j),J(h,e),e&&b(V),J(w,e)}}}function ue(t,a,r){let s,d=!1,c=!1,n=[],m=0,f=[],k,v;se(async()=>{const p=(await F(()=>import("../chunks/Peer-3ebcddc6.js"),["chunks/Peer-3ebcddc6.js","chunks/index-243eeab3.js","chunks/vendor-775b6d8d.js","assets/vendor-b8c56e4e.css"])).default;r(6,k=await v);let E=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),z=new URL(window.location.href);r(0,s=new p(k,E,z.searchParams.get("room"))),s.on("peer",_=>{n.map(M=>M.stream.id).includes(_.stream.id)||r(3,n=[...n,_])}),s.on("open",_=>{r(3,n=[{id:_,username:k,stream:E,video:!0,audio:!0}]),setInterval(()=>r(4,m++,m),1e3)}),s.on("disconnect",_=>{r(3,n=n.filter(M=>M.id!=_))}),s.on("message",_=>{r(5,f=[...f,_])}),s.on("toggle",_=>{let M=n.find(B=>B.id==_.id);M.video=_.video,M.audio=_.audio,r(3,n)})});function j(u){v=u,r(7,v)}return[s,d,c,n,m,f,k,v,j,()=>{n[0].stream.getVideoTracks().forEach(u=>u.enabled=!u.enabled),r(3,n[0].video=!n[0].video,n),s.toggleMedia(!s.videoEnabled)},()=>{n[0].stream.getAudioTracks().forEach(u=>u.enabled=!u.enabled),r(3,n[0].audio=!n[0].audio,n),s.toggleMedia(void 0,!s.audioEnabled)},async u=>{let p=u.detail.source==fe.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0});s.replaceStream(p)},()=>{r(1,d=!d),r(2,c=!1)},()=>{r(2,c=!c),r(1,d=!1)},()=>r(1,d=!1),u=>s.send(u.detail.message),()=>r(2,c=!1)]}class _e extends Q{constructor(a){super();W(this,a,ue,me,X,{})}}export{_e as default};
