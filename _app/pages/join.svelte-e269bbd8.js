import{b as j,_ as L}from"../chunks/paths-16c013c9.js";import{S,i as x,s as C,j as D,m as G,o as N,x as k,u as y,v as T,e as v,t as A,k as $,l as I,Q as J,c as w,a as P,g as K,d as u,n as E,b as h,H as g,f as b,w as M,A as U,r as V}from"../chunks/vendor-91964f2e.js";import{G as z}from"../chunks/Gallery-79ae892e.js";function R(_){let s,o;return s=new z({props:{streams:_[0]}}),{c(){D(s.$$.fragment)},l(e){G(s.$$.fragment,e)},m(e,l){N(s,e,l),o=!0},p(e,l){const m={};l&1&&(m.streams=e[0]),s.$set(m)},i(e){o||(k(s.$$.fragment,e),o=!0)},o(e){y(s.$$.fragment,e),o=!1},d(e){T(s,e)}}}function H(_){let s,o,e,l,m,p,d,f,i,r=_[0].length!==0&&R(_);return{c(){s=v("link"),o=v("link"),e=v("script"),l=A("let parcelRequire;"),m=$(),p=v("div"),d=$(),r&&r.c(),f=I(),this.h()},l(n){const t=J('[data-svelte="svelte-uncxtc"]',document.head);s=w(t,"LINK",{rel:!0,href:!0}),o=w(t,"LINK",{rel:!0,href:!0}),e=w(t,"SCRIPT",{});var a=P(e);l=K(a,"let parcelRequire;"),a.forEach(u),t.forEach(u),m=E(n),p=w(n,"DIV",{class:!0});var c=P(p);c.forEach(u),d=E(n),r&&r.l(n),f=I(),this.h()},h(){h(s,"rel","icon"),h(s,"href",""+(j+"/favicon.png")),h(o,"rel","manifest"),h(o,"href",""+(j+"/manifest.json")),document.title="Join",h(p,"class","w-screen bg-gray-700 h-16")},m(n,t){g(document.head,s),g(document.head,o),g(document.head,e),g(e,l),b(n,m,t),b(n,p,t),b(n,d,t),r&&r.m(n,t),b(n,f,t),i=!0},p(n,[t]){n[0].length!==0?r?(r.p(n,t),t&1&&k(r,1)):(r=R(n),r.c(),k(r,1),r.m(f.parentNode,f)):r&&(V(),y(r,1,1,()=>{r=null}),M())},i(n){i||(k(r),i=!0)},o(n){y(r),i=!1},d(n){u(s),u(o),u(e),n&&u(m),n&&u(p),n&&u(d),r&&r.d(n),n&&u(f)}}}function O(_,s,o){let e=[],l=[];return U(async()=>{const p=(await L(()=>import("../chunks/peerjs.min-cc7cdaeb.js").then(function(t){return t.p}),["chunks/peerjs.min-cc7cdaeb.js","chunks/vendor-91964f2e.js","assets/vendor-b8c56e4e.css"])).default;let d=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});o(0,e=[d]);let f=new URL(window.location.href),i=new p(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),r=t=>{let a=i.call(t,d);return l=[...l,a.peer],a.on("stream",c=>{e.map(q=>q.id).includes(c.id)||o(0,e=[...e,c])}),a},n=t=>{o(0,e=e.filter((a,c)=>l[c]!=t)),l=l.filter(a=>a!=t)};i.on("open",t=>{l=[t],r(f.searchParams.get("room"));let a=i.connect(f.searchParams.get("room"));a.on("data",c=>{switch(c.type){case"connect":r(c.data.peerId);break;case"disconnect":n(c.data.peerId);break}}),a.on("close",()=>{n(a.peer)}),window.onunload=window.onbeforeunload=()=>{a.close()}}),i.on("call",t=>{l=[...l,t.peer],t.answer(d),t.on("stream",a=>{e.map(c=>c.id).includes(a.id)||o(0,e=[...e,a])})}),i.on("connection",t=>t.close())}),[e]}class W extends S{constructor(s){super();x(this,s,O,H,C,{})}}export{W as default};
