import{b as O,_ as W}from"../chunks/paths-16c013c9.js";import{S as X,i as Y,s as Z,j as L,m as R,o as q,x as j,u as I,v as y,e as N,t as x,k as $,L as ee,c as A,a as B,g as se,d as b,n as U,b as M,H as D,f as G,w as re,A as ae,r as ne}from"../chunks/vendor-ef7a3a0d.js";import{N as te,C as oe,M as le,G as ce,S as me}from"../chunks/Members-dd352666.js";function F(t){let c,s;return c=new ce({props:{streams:t[2],sidePanelVisible:t[0]||t[1]}}),{c(){L(c.$$.fragment)},l(a){R(c.$$.fragment,a)},m(a,p){q(c,a,p),s=!0},p(a,p){const r={};p&4&&(r.streams=a[2]),p&3&&(r.sidePanelVisible=a[0]||a[1]),c.$set(r)},i(a){s||(j(c.$$.fragment,a),s=!0)},o(a){I(c.$$.fragment,a),s=!1},d(a){y(c,a)}}}function ie(t){let c,s,a,p,r,f,n,_,g,E,i,C,w,V;n=new te({props:{time:t[3],peer:!0}}),n.$on("videoswitch",t[9]),n.$on("muteswitch",t[10]),n.$on("sourceswitch",t[11]),n.$on("chatswitch",t[12]),n.$on("membersswitch",t[13]);let o=t[2].length!==0&&F(t);return i=new oe({props:{visible:t[0],messages:t[6]}}),i.$on("close",t[14]),i.$on("messagesend",t[15]),w=new le({props:{visible:t[1],users:t[2]}}),w.$on("close",t[16]),{c(){c=N("link"),s=N("link"),a=N("script"),p=x("let parcelRequire;"),r=$(),f=N("div"),L(n.$$.fragment),_=$(),o&&o.c(),E=$(),L(i.$$.fragment),C=$(),L(w.$$.fragment),this.h()},l(e){const l=ee('[data-svelte="svelte-uncxtc"]',document.head);c=A(l,"LINK",{rel:!0,href:!0}),s=A(l,"LINK",{rel:!0,href:!0}),a=A(l,"SCRIPT",{});var P=B(a);p=se(P,"let parcelRequire;"),P.forEach(b),l.forEach(b),r=U(e),f=A(e,"DIV",{class:!0});var k=B(f);R(n.$$.fragment,k),_=U(k),o&&o.l(k),k.forEach(b),E=U(e),R(i.$$.fragment,e),C=U(e),R(w.$$.fragment,e),this.h()},h(){M(c,"rel","icon"),M(c,"href",""+(O+"/favicon.png")),M(s,"rel","manifest"),M(s,"href",""+(O+"/manifest.json")),document.title="Join",M(f,"class",g=""+((t[0]||t[1]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center"))},m(e,l){D(document.head,c),D(document.head,s),D(document.head,a),D(a,p),G(e,r,l),G(e,f,l),q(n,f,null),D(f,_),o&&o.m(f,null),G(e,E,l),q(i,e,l),G(e,C,l),q(w,e,l),V=!0},p(e,[l]){const P={};l&8&&(P.time=e[3]),n.$set(P),e[2].length!==0?o?(o.p(e,l),l&4&&j(o,1)):(o=F(e),o.c(),j(o,1),o.m(f,null)):o&&(ne(),I(o,1,1,()=>{o=null}),re()),(!V||l&3&&g!==(g=""+((e[0]||e[1]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center")))&&M(f,"class",g);const k={};l&1&&(k.visible=e[0]),l&64&&(k.messages=e[6]),i.$set(k);const h={};l&2&&(h.visible=e[1]),l&4&&(h.users=e[2]),w.$set(h)},i(e){V||(j(n.$$.fragment,e),j(o),j(i.$$.fragment,e),j(w.$$.fragment,e),V=!0)},o(e){I(n.$$.fragment,e),I(o),I(i.$$.fragment,e),I(w.$$.fragment,e),V=!1},d(e){b(c),b(s),b(a),e&&b(r),e&&b(f),y(n),o&&o.d(),e&&b(E),y(i,e),e&&b(C),y(w,e)}}}function ue(t,c,s){let a=!1,p=!1,r=[],f=0,n=[],_=[],g=[],E,i="";return ae(async()=>{const J=(await W(()=>import("../chunks/peerjs.min-3f0f69c5.js").then(function(u){return u.p}),["chunks/peerjs.min-3f0f69c5.js","chunks/vendor-ef7a3a0d.js","assets/vendor-b8c56e4e.css"])).default;s(8,i=window.prompt("Enter username: "));let S=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});s(2,r=[{username:i,stream:S}]);let T=new URL(window.location.href),v=new J(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),K=(u,d="")=>{let m=v.call(u,S,{metadata:{username:i}});return s(4,n=[...n,m.peer]),s(5,_=[..._,m]),m.on("stream",H=>{r.map(Q=>Q.stream.id).includes(H.id)||s(2,r=[...r,{username:d,stream:H}])}),m},z=u=>{console.log(r),console.log(n),console.log(_),s(2,r=r.filter((d,m)=>n[m]!=u)),s(4,n=n.filter(d=>d!=u)),s(5,_=_.filter(d=>d.peer!=u))};v.on("open",u=>{s(4,n=[u]),K(T.searchParams.get("room"));let d=v.connect(T.searchParams.get("room"),{metadata:{username:i}});d.on("data",m=>{switch(m.type){case"connect":K(m.data.peerId,m.data.username);break;case"disconnect":console.log(m.data.peerId),z(m.data.peerId);break;case"username":s(2,r[1].username=m.data.username,r);break;case"message":s(6,g=[...g,{author:m.data.author,message:m.data.message,id:m.data.id,me:!1}]);break}}),d.on("close",()=>{z(d.peer)}),window.onunload=window.onbeforeunload=()=>{d.close()},s(7,E=d),setInterval(()=>s(3,f++,f),1e3)}),v.on("call",u=>{s(4,n=[...n,u.peer]),s(5,_=[..._,u]),u.answer(S),u.on("stream",d=>{r.map(m=>m.stream.id).includes(d.id)||s(2,r=[...r,{username:u.metadata.username,stream:d}])})}),v.on("connection",u=>u.close())}),[a,p,r,f,n,_,g,E,i,()=>r[0].stream.getVideoTracks().forEach(h=>h.enabled=!h.enabled),()=>r[0].stream.getAudioTracks().forEach(h=>h.enabled=!h.enabled),async h=>{let S=(h.detail.source==me.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];r[0].stream.getVideoTracks().forEach(T=>{T.stop(),r[0].stream.removeTrack(T)}),r[0].stream.addTrack(S),_.forEach(T=>T.peerConnection.getSenders().filter(v=>v.track.kind=="video").forEach(v=>v.replaceTrack(S)))},()=>{s(0,a=!a),s(1,p=!1)},()=>{s(1,p=!p),s(0,a=!1)},()=>s(0,a=!1),h=>{E.send({type:"message",data:{message:h.detail.message}}),s(6,g=[...g,{author:i,message:h.detail.message,id:n[0],me:!0}])},()=>s(1,p=!1)]}class pe extends X{constructor(c){super();Y(this,c,ue,ie,Z,{})}}export{pe as default};
