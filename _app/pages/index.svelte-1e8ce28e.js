import{b as H,_ as z}from"../chunks/paths-16c013c9.js";import{S as J,i as B,s as F,j as P,m as R,o as q,x as E,u as V,v as C,e as N,t as Q,k as A,J as W,c as G,a as K,g as X,d as w,n as L,b as y,H as D,f as O,w as Y,A as Z,r as x}from"../chunks/vendor-d517c024.js";import{N as ee,C as se,M as re,G as ae,S as te}from"../chunks/Members-1b9f8f13.js";function U(n){let i,a;return i=new ae({props:{streams:n[0],sidePanelVisible:n[6]||n[7]}}),{c(){P(i.$$.fragment)},l(s){R(i.$$.fragment,s)},m(s,m){q(i,s,m),a=!0},p(s,m){const h={};m&1&&(h.streams=s[0]),m&192&&(h.sidePanelVisible=s[6]||s[7]),i.$set(h)},i(s){a||(E(i.$$.fragment,s),a=!0)},o(s){V(i.$$.fragment,s),a=!1},d(s){C(i,s)}}}function ne(n){let i,a,s,m,h,f,t,b,p,_,c,I,g,$;t=new ee({props:{time:n[2]}}),t.$on("videoswitch",n[9]),t.$on("muteswitch",n[10]),t.$on("sourceswitch",n[11]),t.$on("chatswitch",n[12]),t.$on("membersswitch",n[13]);let l=n[0].length!==0&&U(n);return c=new se({props:{visible:n[6],messages:n[5]}}),c.$on("close",n[14]),c.$on("messagesend",n[15]),g=new re({props:{visible:n[7],users:n[0]}}),g.$on("close",n[16]),{c(){i=N("link"),a=N("link"),s=N("script"),m=Q("let parcelRequire;"),h=A(),f=N("div"),P(t.$$.fragment),b=A(),l&&l.c(),_=A(),P(c.$$.fragment),I=A(),P(g.$$.fragment),this.h()},l(e){const o=W('[data-svelte="svelte-tu3wcf"]',document.head);i=G(o,"LINK",{rel:!0,href:!0}),a=G(o,"LINK",{rel:!0,href:!0}),s=G(o,"SCRIPT",{});var T=K(s);m=X(T,"let parcelRequire;"),T.forEach(w),o.forEach(w),h=L(e),f=G(e,"DIV",{class:!0});var k=K(f);R(t.$$.fragment,k),b=L(k),l&&l.l(k),k.forEach(w),_=L(e),R(c.$$.fragment,e),I=L(e),R(g.$$.fragment,e),this.h()},h(){y(i,"rel","icon"),y(i,"href",""+(H+"/favicon.png")),y(a,"rel","manifest"),y(a,"href",""+(H+"/manifest.json")),document.title="Home",y(f,"class",p=""+((n[6]||n[7]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center"))},m(e,o){D(document.head,i),D(document.head,a),D(document.head,s),D(s,m),O(e,h,o),O(e,f,o),q(t,f,null),D(f,b),l&&l.m(f,null),O(e,_,o),q(c,e,o),O(e,I,o),q(g,e,o),$=!0},p(e,[o]){const T={};o&4&&(T.time=e[2]),t.$set(T),e[0].length!==0?l?(l.p(e,o),o&1&&E(l,1)):(l=U(e),l.c(),E(l,1),l.m(f,null)):l&&(x(),V(l,1,1,()=>{l=null}),Y()),(!$||o&192&&p!==(p=""+((e[6]||e[7]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center")))&&y(f,"class",p);const k={};o&64&&(k.visible=e[6]),o&32&&(k.messages=e[5]),c.$set(k);const d={};o&128&&(d.visible=e[7]),o&1&&(d.users=e[0]),g.$set(d)},i(e){$||(E(t.$$.fragment,e),E(l),E(c.$$.fragment,e),E(g.$$.fragment,e),$=!0)},o(e){V(t.$$.fragment,e),V(l),V(c.$$.fragment,e),V(g.$$.fragment,e),$=!1},d(e){w(i),w(a),w(s),e&&w(h),e&&w(f),C(t),l&&l.d(),e&&w(_),C(c,e),e&&w(I),C(g,e)}}}function le(n,i,a){let s=[],m=[],h=0,f=[],t=[],b=[],p=!1,_=!1,c="";return Z(async()=>{const M=(await z(()=>import("../chunks/peerjs.min-0b116e46.js").then(function(r){return r.p}),["chunks/peerjs.min-0b116e46.js","chunks/vendor-d517c024.js","assets/vendor-b8c56e4e.css"])).default;a(8,c="DeathGuard12");let S=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});a(0,s=[{username:c,stream:S}]);let v=new M(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}});v.on("open",r=>{console.log(r),a(1,m=[r]),setInterval(()=>a(2,h++,h),1e3)}),v.on("call",r=>{a(1,m=[...m,r.peer]),a(3,f=[...f,r]),r.answer(S),r.on("stream",u=>{s.map(j=>j.stream.id).includes(u.id)||a(0,s=[...s,{username:r.metadata.username,stream:u}])})}),v.on("connection",r=>{r.on("open",()=>{t.forEach(u=>{u.send({type:"connect",data:{peerId:r.peer,username:r.metadata.username}})}),r.send({type:"username",data:{username:c}}),t.push(r)}),r.on("close",()=>{a(4,t=t.filter(u=>u!=r)),a(0,s=s.filter((u,j)=>m[j]!=r.peer)),a(1,m=m.filter(u=>u!=r.peer)),a(3,f=f.filter(u=>u.peer!=r.peer)),t.forEach(u=>{u.send({type:"disconnect",data:{peerId:r.peer}})})}),r.on("data",u=>{switch(u.type){case"message":t.forEach(j=>{j.peer!=r.peer&&j.send({type:"message",data:{author:s[t.indexOf(r)].username,message:u.data.message,id:r.peer}})}),a(5,b=[...b,{author:s[t.indexOf(r)].username,message:u.data.message,id:r.peer,me:!1}]);break}}),window.onunload=window.onbeforeunload=()=>{r.close()}})}),[s,m,h,f,t,b,p,_,c,()=>s[0].stream.getVideoTracks().forEach(d=>d.enabled=!d.enabled),()=>s[0].stream.getAudioTracks().forEach(d=>d.enabled=!d.enabled),async d=>{let S=(d.detail.source==te.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];s[0].stream.getVideoTracks().forEach(v=>{v.stop(),s[0].stream.removeTrack(v)}),s[0].stream.addTrack(S),f.forEach(v=>v.peerConnection.getSenders().filter(r=>r.track.kind=="video").forEach(r=>r.replaceTrack(S)))},()=>{a(6,p=!p),a(7,_=!1)},()=>{a(7,_=!_),a(6,p=!1)},()=>a(6,p=!1),d=>{t.forEach(M=>{M.send({type:"message",data:{author:c,message:d.detail.message,id:m[0]}})}),a(5,b=[...b,{author:c,message:d.detail.message,id:m[0],me:!0}])},()=>a(7,_=!1)]}class fe extends J{constructor(i){super();B(this,i,le,ne,F,{})}}export{fe as default};
