import{b as K,_ as Q}from"../chunks/paths-16c013c9.js";import{S as W,i as X,s as Y,j as I,m as N,o as D,L as Z,x as g,u as k,v as J,e as T,t as x,k as L,M as ee,c as A,a as O,g as se,d as b,n as R,b as S,H as q,f as C,w as U,A as ne,N as re,O as ae,r as H}from"../chunks/vendor-657f76b4.js";import{N as te,C as ie,M as oe,J as le,G as fe,S as me}from"../chunks/JoinPopup-96167371.js";function y(a){let t,r,s;function d(n){a[8](n)}let c={};return a[7]!==void 0&&(c.promise=a[7]),t=new le({props:c}),re.push(()=>ae(t,"promise",d)),{c(){I(t.$$.fragment)},l(n){N(t.$$.fragment,n)},m(n,m){D(t,n,m),s=!0},p(n,m){const f={};!r&&m&128&&(r=!0,f.promise=n[7],Z(()=>r=!1)),t.$set(f)},i(n){s||(g(t.$$.fragment,n),s=!0)},o(n){k(t.$$.fragment,n),s=!1},d(n){J(t,n)}}}function z(a){let t,r;return t=new fe({props:{streams:a[3],sidePanelVisible:a[1]||a[2]}}),{c(){I(t.$$.fragment)},l(s){N(t.$$.fragment,s)},m(s,d){D(t,s,d),r=!0},p(s,d){const c={};d&8&&(c.streams=s[3]),d&6&&(c.sidePanelVisible=s[1]||s[2]),t.$set(c)},i(s){r||(g(t.$$.fragment,s),r=!0)},o(s){k(t.$$.fragment,s),r=!1},d(s){J(t,s)}}}function ue(a){let t,r,s,d,c,n,m,f,j,$,P,h,V,w,E,o=a[6]==null&&y(a);f=new te({props:{time:a[4],peer:!0}}),f.$on("videoswitch",a[9]),f.$on("muteswitch",a[10]),f.$on("sourceswitch",a[11]),f.$on("chatswitch",a[12]),f.$on("membersswitch",a[13]);let l=a[3].length!==0&&z(a);return h=new ie({props:{visible:a[1],messages:a[5]}}),h.$on("close",a[14]),h.$on("messagesend",a[15]),w=new oe({props:{visible:a[2],users:a[3]}}),w.$on("close",a[16]),{c(){t=T("link"),r=T("link"),s=T("script"),d=x("let parcelRequire;"),c=L(),o&&o.c(),n=L(),m=T("div"),I(f.$$.fragment),j=L(),l&&l.c(),P=L(),I(h.$$.fragment),V=L(),I(w.$$.fragment),this.h()},l(e){const i=ee('[data-svelte="svelte-uncxtc"]',document.head);t=A(i,"LINK",{rel:!0,href:!0}),r=A(i,"LINK",{rel:!0,href:!0}),s=A(i,"SCRIPT",{});var u=O(s);d=se(u,"let parcelRequire;"),u.forEach(b),i.forEach(b),c=R(e),o&&o.l(e),n=R(e),m=A(e,"DIV",{class:!0});var p=O(m);N(f.$$.fragment,p),j=R(p),l&&l.l(p),p.forEach(b),P=R(e),N(h.$$.fragment,e),V=R(e),N(w.$$.fragment,e),this.h()},h(){S(t,"rel","icon"),S(t,"href",""+(K+"/favicon.png")),S(r,"rel","manifest"),S(r,"href",""+(K+"/manifest.json")),document.title="Join",S(m,"class",$=""+((a[1]||a[2]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center"))},m(e,i){q(document.head,t),q(document.head,r),q(document.head,s),q(s,d),C(e,c,i),o&&o.m(e,i),C(e,n,i),C(e,m,i),D(f,m,null),q(m,j),l&&l.m(m,null),C(e,P,i),D(h,e,i),C(e,V,i),D(w,e,i),E=!0},p(e,[i]){e[6]==null?o?(o.p(e,i),i&64&&g(o,1)):(o=y(e),o.c(),g(o,1),o.m(n.parentNode,n)):o&&(H(),k(o,1,1,()=>{o=null}),U());const u={};i&16&&(u.time=e[4]),f.$set(u),e[3].length!==0?l?(l.p(e,i),i&8&&g(l,1)):(l=z(e),l.c(),g(l,1),l.m(m,null)):l&&(H(),k(l,1,1,()=>{l=null}),U()),(!E||i&6&&$!==($=""+((e[1]||e[2]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center")))&&S(m,"class",$);const p={};i&2&&(p.visible=e[1]),i&32&&(p.messages=e[5]),h.$set(p);const v={};i&4&&(v.visible=e[2]),i&8&&(v.users=e[3]),w.$set(v)},i(e){E||(g(o),g(f.$$.fragment,e),g(l),g(h.$$.fragment,e),g(w.$$.fragment,e),E=!0)},o(e){k(o),k(f.$$.fragment,e),k(l),k(h.$$.fragment,e),k(w.$$.fragment,e),E=!1},d(e){b(t),b(r),b(s),e&&b(c),o&&o.d(e),e&&b(n),e&&b(m),J(f),l&&l.d(),e&&b(P),J(h,e),e&&b(V),J(w,e)}}}function ce(a,t,r){let s,d=!1,c=!1,n=[],m=0,f=[],j,$;ne(async()=>{const p=(await Q(()=>import("../chunks/Peer-8e9dfe31.js"),["chunks/Peer-8e9dfe31.js","chunks/index-c6cf7118.js","chunks/vendor-657f76b4.js","assets/vendor-b8c56e4e.css"])).default;let v=await $;r(6,j=v.username);let G=v.stream,B=new URL(window.location.href);r(0,s=new p(j,G,B.searchParams.get("room"))),s.toggleMedia(v.video,v.audio),s.on("peer",_=>{n.map(M=>M.stream.id).includes(_.stream.id)||r(3,n=[...n,_])}),s.on("open",_=>{r(3,n=[{id:_,username:j,stream:G,video:v.video,audio:v.audio}]),setInterval(()=>r(4,m++,m),1e3)}),s.on("disconnect",_=>{r(3,n=n.filter(M=>M.id!=_))}),s.on("message",_=>{r(5,f=[...f,_])}),s.on("toggle",_=>{let M=n.find(F=>F.id==_.id);M.video=_.video,M.audio=_.audio,r(3,n)})});function P(u){$=u,r(7,$)}return[s,d,c,n,m,f,j,$,P,()=>{n[0].stream.getVideoTracks().forEach(u=>u.enabled=!u.enabled),r(3,n[0].video=!n[0].video,n),s.toggleMedia(!s.videoEnabled)},()=>{n[0].stream.getAudioTracks().forEach(u=>u.enabled=!u.enabled),r(3,n[0].audio=!n[0].audio,n),s.toggleMedia(void 0,!s.audioEnabled)},async u=>{let p=u.detail.source==me.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0});s.replaceStream(p)},()=>{r(1,d=!d),r(2,c=!1)},()=>{r(2,c=!c),r(1,d=!1)},()=>r(1,d=!1),u=>s.send(u.detail.message),()=>r(2,c=!1)]}class he extends W{constructor(t){super();X(this,t,ce,ue,Y,{})}}export{he as default};
