import{b as y,_ as R}from"../chunks/paths-16c013c9.js";import{S as q,i as E,s as I,j as L,m as S,o as x,x as d,u as b,v as G,e as k,t as J,k as N,l as j,J as A,c as w,a as C,g as D,d as u,n as K,b as h,H as g,f as $,w as M,A as T,r as U}from"../chunks/vendor-07f555be.js";import{G as z}from"../chunks/Gallery-4bcb3b09.js";function P(m){let n,s;return n=new z({props:{streams:m[0]}}),{c(){L(n.$$.fragment)},l(e){S(n.$$.fragment,e)},m(e,o){x(n,e,o),s=!0},p(e,o){const l={};o&1&&(l.streams=e[0]),n.$set(l)},i(e){s||(d(n.$$.fragment,e),s=!0)},o(e){b(n.$$.fragment,e),s=!1},d(e){G(n,e)}}}function H(m){let n,s,e,o,l,i,c,t=m[0].length!==0&&P(m);return{c(){n=k("link"),s=k("link"),e=k("script"),o=J("let parcelRequire;"),l=N(),t&&t.c(),i=j(),this.h()},l(r){const a=A('[data-svelte="svelte-uncxtc"]',document.head);n=w(a,"LINK",{rel:!0,href:!0}),s=w(a,"LINK",{rel:!0,href:!0}),e=w(a,"SCRIPT",{});var f=C(e);o=D(f,"let parcelRequire;"),f.forEach(u),a.forEach(u),l=K(r),t&&t.l(r),i=j(),this.h()},h(){h(n,"rel","icon"),h(n,"href",""+(y+"/favicon.png")),h(s,"rel","manifest"),h(s,"href",""+(y+"/manifest.json")),document.title="Join"},m(r,a){g(document.head,n),g(document.head,s),g(document.head,e),g(e,o),$(r,l,a),t&&t.m(r,a),$(r,i,a),c=!0},p(r,[a]){r[0].length!==0?t?(t.p(r,a),a&1&&d(t,1)):(t=P(r),t.c(),d(t,1),t.m(i.parentNode,i)):t&&(U(),b(t,1,1,()=>{t=null}),M())},i(r){c||(d(t),c=!0)},o(r){b(t),c=!1},d(r){u(n),u(s),u(e),r&&u(l),t&&t.d(r),r&&u(i)}}}function O(m,n,s){let e=[],o=[];return T(async()=>{const i=(await R(()=>import("../chunks/peerjs.min-90eb8cad.js").then(function(a){return a.p}),["chunks/peerjs.min-90eb8cad.js","chunks/vendor-07f555be.js"])).default;let c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});s(0,e=[c]);let t=new URL(window.location.href),r=new i(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}});r.on("open",a=>{o=[a];let f=r.call(t.searchParams.get("room"),c);o=[...o,f.peer],f.on("stream",p=>{e.map(v=>v.id).includes(p.id)||s(0,e=[...e,p])});let _=r.connect(t.searchParams.get("room"));_.on("close",()=>{s(0,e=e.filter((p,v)=>o[v]!=_.peer)),o=o.filter(p=>p!=_.peer)}),window.onbeforeunload=()=>{_.close()}})}),[e]}class Q extends q{constructor(n){super();E(this,n,O,H,I,{})}}export{Q as default};
