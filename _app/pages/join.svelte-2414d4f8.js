import{b as y,_ as R}from"../chunks/paths-16c013c9.js";import{S as q,i as E,s as L,j as S,m as x,o as C,x as h,u as v,v as G,e as w,t as J,k as N,l as j,J as T,c as b,a as A,g as D,d as p,n as K,b as g,H as k,f as $,w as M,A as U,r as z}from"../chunks/vendor-07f555be.js";import{G as H}from"../chunks/Gallery-3b700d69.js";function P(d){let r,s;return r=new H({props:{streams:d[0]}}),{c(){S(r.$$.fragment)},l(e){x(r.$$.fragment,e)},m(e,a){C(r,e,a),s=!0},p(e,a){const u={};a&1&&(u.streams=e[0]),r.$set(u)},i(e){s||(h(r.$$.fragment,e),s=!0)},o(e){v(r.$$.fragment,e),s=!1},d(e){G(r,e)}}}function O(d){let r,s,e,a,u,m,f,t=d[0].length!==0&&P(d);return{c(){r=w("link"),s=w("link"),e=w("script"),a=J("let parcelRequire;"),u=N(),t&&t.c(),m=j(),this.h()},l(n){const o=T('[data-svelte="svelte-uncxtc"]',document.head);r=b(o,"LINK",{rel:!0,href:!0}),s=b(o,"LINK",{rel:!0,href:!0}),e=b(o,"SCRIPT",{});var _=A(e);a=D(_,"let parcelRequire;"),_.forEach(p),o.forEach(p),u=K(n),t&&t.l(n),m=j(),this.h()},h(){g(r,"rel","icon"),g(r,"href",""+(y+"/favicon.png")),g(s,"rel","manifest"),g(s,"href",""+(y+"/manifest.json")),document.title="Join"},m(n,o){k(document.head,r),k(document.head,s),k(document.head,e),k(e,a),$(n,u,o),t&&t.m(n,o),$(n,m,o),f=!0},p(n,[o]){n[0].length!==0?t?(t.p(n,o),o&1&&h(t,1)):(t=P(n),t.c(),h(t,1),t.m(m.parentNode,m)):t&&(z(),v(t,1,1,()=>{t=null}),M())},i(n){f||(h(t),f=!0)},o(n){v(t),f=!1},d(n){p(r),p(s),p(e),n&&p(u),t&&t.d(n),n&&p(m)}}}function V(d,r,s){let e=[],a=[];return U(async()=>{const m=(await R(()=>import("../chunks/peerjs.min-90eb8cad.js").then(function(l){return l.p}),["chunks/peerjs.min-90eb8cad.js","chunks/vendor-07f555be.js"])).default;let f=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});s(0,e=[f]);let t=new URL(window.location.href),n=new m(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),o=l=>{let c=n.call(l,f);return a=[...a,c.peer],c.on("stream",i=>{e.map(I=>I.id).includes(i.id)||s(0,e=[...e,i])}),c},_=l=>{s(0,e=e.filter((c,i)=>a[i]!=l)),a=a.filter(c=>c!=l)};n.on("open",l=>{a=[l],o(t.searchParams.get("room"));let c=n.connect(t.searchParams.get("room"));c.on("data",i=>{switch(i.type){case"connect":o(i.data.peerId);break;case"disconnect":_(i.data.peerId);break}}),c.on("close",()=>{_(c.peer)}),window.onunload=window.onbeforeunload=()=>{c.close()}}),n.on("call",l=>{a=[...a,l.peer],l.answer(f),l.on("stream",c=>{e.map(i=>i.id).includes(c.id)||s(0,e=[...e,c])})}),n.on("connection",l=>l.close())}),[e]}class W extends q{constructor(r){super();E(this,r,V,O,L,{})}}export{W as default};
