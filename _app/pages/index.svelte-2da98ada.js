import{b as w,_ as $}from"../chunks/paths-16c013c9.js";import{S as E,i as I,s as R,j as q,m as P,o as S,x as p,u as g,v as G,e as k,t as L,k as N,l as b,J as x,c as v,a as A,g as C,d as f,n as D,b as d,H as _,f as y,w as H,A as K,r as M}from"../chunks/vendor-07f555be.js";import{G as T}from"../chunks/Gallery-e95ffafa.js";function j(m){let a,n;return a=new T({props:{streams:m[0]}}),{c(){q(a.$$.fragment)},l(t){P(a.$$.fragment,t)},m(t,o){S(a,t,o),n=!0},p(t,o){const i={};o&1&&(i.streams=t[0]),a.$set(i)},i(t){n||(p(a.$$.fragment,t),n=!0)},o(t){g(a.$$.fragment,t),n=!1},d(t){G(a,t)}}}function z(m){let a,n,t,o,i,c,u,r=m[0].length!==0&&j(m);return{c(){a=k("link"),n=k("link"),t=k("script"),o=L("let parcelRequire;"),i=N(),r&&r.c(),c=b(),this.h()},l(s){const e=x('[data-svelte="svelte-tu3wcf"]',document.head);a=v(e,"LINK",{rel:!0,href:!0}),n=v(e,"LINK",{rel:!0,href:!0}),t=v(e,"SCRIPT",{});var l=A(t);o=C(l,"let parcelRequire;"),l.forEach(f),e.forEach(f),i=D(s),r&&r.l(s),c=b(),this.h()},h(){d(a,"rel","icon"),d(a,"href",""+(w+"/favicon.png")),d(n,"rel","manifest"),d(n,"href",""+(w+"/manifest.json")),document.title="Home"},m(s,e){_(document.head,a),_(document.head,n),_(document.head,t),_(t,o),y(s,i,e),r&&r.m(s,e),y(s,c,e),u=!0},p(s,[e]){s[0].length!==0?r?(r.p(s,e),e&1&&p(r,1)):(r=j(s),r.c(),p(r,1),r.m(c.parentNode,c)):r&&(M(),g(r,1,1,()=>{r=null}),H())},i(s){u||(p(r),u=!0)},o(s){g(r),u=!1},d(s){f(a),f(n),f(t),s&&f(i),r&&r.d(s),s&&f(c)}}}function J(m,a,n){let t=[],o=[];return K(async()=>{const c=(await $(()=>import("../chunks/peerjs.min-90eb8cad.js").then(function(e){return e.p}),["chunks/peerjs.min-90eb8cad.js","chunks/vendor-07f555be.js"])).default;let u=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});n(0,t=[u]);let r=[],s=new c(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}});s.on("open",e=>{console.log(e),o=[e]}),s.on("call",e=>{o=[...o,e.peer],e.answer(u),e.on("stream",l=>{t.map(h=>h.id).includes(l.id)||n(0,t=[...t,l])})}),s.on("connection",e=>{e.on("open",()=>{r.forEach(l=>{l.send({type:"connect",data:{peerId:e.peer}})}),r.push(e)}),e.on("close",()=>{r=r.filter(l=>l!=e),n(0,t=t.filter((l,h)=>o[h]!=e.peer)),o=o.filter(l=>l!=e.peer),r.forEach(l=>{l.send({type:"disconnect",data:{peerId:e.peer}})})}),window.onunload=window.onbeforeunload=()=>{e.close()}})}),[t]}class B extends E{constructor(a){super();I(this,a,J,z,R,{})}}export{B as default};
