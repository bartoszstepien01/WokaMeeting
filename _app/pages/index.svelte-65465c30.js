import{b as S,_ as A}from"../chunks/paths-16c013c9.js";import{S as C,i as L,s as G,j as I,m as N,o as D,x as v,u as w,v as R,e as E,t as H,k as q,l as M,J as K,c as T,a as U,g as z,d as p,n as P,b as k,H as b,f as j,w as J,A as O,r as B}from"../chunks/vendor-7e45e1c8.js";import{N as F,G as Q,S as W}from"../chunks/Navbar-122f9e05.js";function V(d){let n,o;return n=new Q({props:{streams:d[0]}}),{c(){I(n.$$.fragment)},l(e){N(n.$$.fragment,e)},m(e,l){D(n,e,l),o=!0},p(e,l){const u={};l&1&&(u.streams=e[0]),n.$set(u)},i(e){o||(v(n.$$.fragment,e),o=!0)},o(e){w(n.$$.fragment,e),o=!1},d(e){R(n,e)}}}function X(d){let n,o,e,l,u,i,_,h,g;i=new F({props:{time:d[1]}}),i.$on("videoswitch",d[3]),i.$on("muteswitch",d[4]),i.$on("sourceswitch",d[5]);let t=d[0].length!==0&&V(d);return{c(){n=E("link"),o=E("link"),e=E("script"),l=H("let parcelRequire;"),u=q(),I(i.$$.fragment),_=q(),t&&t.c(),h=M(),this.h()},l(r){const s=K('[data-svelte="svelte-tu3wcf"]',document.head);n=T(s,"LINK",{rel:!0,href:!0}),o=T(s,"LINK",{rel:!0,href:!0}),e=T(s,"SCRIPT",{});var c=U(e);l=z(c,"let parcelRequire;"),c.forEach(p),s.forEach(p),u=P(r),N(i.$$.fragment,r),_=P(r),t&&t.l(r),h=M(),this.h()},h(){k(n,"rel","icon"),k(n,"href",""+(S+"/favicon.png")),k(o,"rel","manifest"),k(o,"href",""+(S+"/manifest.json")),document.title="Home"},m(r,s){b(document.head,n),b(document.head,o),b(document.head,e),b(e,l),j(r,u,s),D(i,r,s),j(r,_,s),t&&t.m(r,s),j(r,h,s),g=!0},p(r,[s]){const c={};s&2&&(c.time=r[1]),i.$set(c),r[0].length!==0?t?(t.p(r,s),s&1&&v(t,1)):(t=V(r),t.c(),v(t,1),t.m(h.parentNode,h)):t&&(B(),w(t,1,1,()=>{t=null}),J())},i(r){g||(v(i.$$.fragment,r),v(t),g=!0)},o(r){w(i.$$.fragment,r),w(t),g=!1},d(r){p(n),p(o),p(e),r&&p(u),R(i,r),r&&p(_),t&&t.d(r),r&&p(h)}}}function Y(d,n,o){let e=[],l=[],u=0,i=[];return O(async()=>{const r=(await A(()=>import("../chunks/peerjs.min-8eb05041.js").then(function(a){return a.p}),["chunks/peerjs.min-8eb05041.js","chunks/vendor-7e45e1c8.js","assets/vendor-b8c56e4e.css"])).default;let s=window.prompt("Enter username: "),c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});o(0,e=[{username:s,stream:c}]);let f=[],$=new r(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}});$.on("open",a=>{console.log(a),l=[a],setInterval(()=>o(1,u++,u),1e3)}),$.on("call",a=>{l=[...l,a.peer],o(2,i=[...i,a]),a.answer(c),a.on("stream",m=>{e.map(y=>y.stream.id).includes(m.id)||o(0,e=[...e,{username:a.metadata.username,stream:m}])})}),$.on("connection",a=>{a.on("open",()=>{f.forEach(m=>{m.send({type:"connect",data:{peerId:a.peer,username:a.metadata.username}})}),a.send({type:"username",data:{username:s}}),f.push(a)}),a.on("close",()=>{f=f.filter(m=>m!=a),o(0,e=e.filter((m,y)=>l[y]!=a.peer)),l=l.filter(m=>m!=a.peer),o(2,i=i.filter(m=>m.peer!=a.peer)),f.forEach(m=>{m.send({type:"disconnect",data:{peerId:a.peer}})})}),window.onunload=window.onbeforeunload=()=>{a.close()}})}),[e,u,i,()=>e[0].stream.getVideoTracks().forEach(t=>t.enabled=!t.enabled),()=>e[0].stream.getAudioTracks().forEach(t=>t.enabled=!t.enabled),async t=>{let s=(t.detail.source==W.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];e[0].stream.getVideoTracks().forEach(c=>{c.stop(),e[0].stream.removeTrack(c)}),e[0].stream.addTrack(s),i.forEach(c=>c.peerConnection.getSenders().filter(f=>f.track.kind=="video").forEach(f=>f.replaceTrack(s)))}]}class te extends C{constructor(n){super();L(this,n,Y,X,G,{})}}export{te as default};
