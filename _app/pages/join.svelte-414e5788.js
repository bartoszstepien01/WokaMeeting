import{b as O,_ as W}from"../chunks/paths-16c013c9.js";import{S as X,i as Y,s as Z,j as R,m as q,o as y,x as j,u as D,v as L,e as N,t as x,k as $,J as ee,c as A,a as B,g as se,d as w,n as G,b as M,H as I,f as J,w as re,A as ae,r as te}from"../chunks/vendor-d517c024.js";import{N as ne,C as oe,M as le,G as ce,S as me}from"../chunks/Members-1b9f8f13.js";function F(n){let c,s;return c=new ce({props:{streams:n[2],sidePanelVisible:n[0]||n[1]}}),{c(){R(c.$$.fragment)},l(r){q(c.$$.fragment,r)},m(r,_){y(c,r,_),s=!0},p(r,_){const a={};_&4&&(a.streams=r[2]),_&3&&(a.sidePanelVisible=r[0]||r[1]),c.$set(a)},i(r){s||(j(c.$$.fragment,r),s=!0)},o(r){D(c.$$.fragment,r),s=!1},d(r){L(c,r)}}}function ie(n){let c,s,r,_,a,f,t,p,g,T,m,C,b,V;t=new ne({props:{time:n[3]}}),t.$on("videoswitch",n[9]),t.$on("muteswitch",n[10]),t.$on("sourceswitch",n[11]),t.$on("chatswitch",n[12]),t.$on("membersswitch",n[13]);let o=n[2].length!==0&&F(n);return m=new oe({props:{visible:n[0],messages:n[6]}}),m.$on("close",n[14]),m.$on("messagesend",n[15]),b=new le({props:{visible:n[1],users:n[2]}}),b.$on("close",n[16]),{c(){c=N("link"),s=N("link"),r=N("script"),_=x("let parcelRequire;"),a=$(),f=N("div"),R(t.$$.fragment),p=$(),o&&o.c(),T=$(),R(m.$$.fragment),C=$(),R(b.$$.fragment),this.h()},l(e){const l=ee('[data-svelte="svelte-uncxtc"]',document.head);c=A(l,"LINK",{rel:!0,href:!0}),s=A(l,"LINK",{rel:!0,href:!0}),r=A(l,"SCRIPT",{});var P=B(r);_=se(P,"let parcelRequire;"),P.forEach(w),l.forEach(w),a=G(e),f=A(e,"DIV",{class:!0});var k=B(f);q(t.$$.fragment,k),p=G(k),o&&o.l(k),k.forEach(w),T=G(e),q(m.$$.fragment,e),C=G(e),q(b.$$.fragment,e),this.h()},h(){M(c,"rel","icon"),M(c,"href",""+(O+"/favicon.png")),M(s,"rel","manifest"),M(s,"href",""+(O+"/manifest.json")),document.title="Join",M(f,"class",g=""+((n[0]||n[1]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center"))},m(e,l){I(document.head,c),I(document.head,s),I(document.head,r),I(r,_),J(e,a,l),J(e,f,l),y(t,f,null),I(f,p),o&&o.m(f,null),J(e,T,l),y(m,e,l),J(e,C,l),y(b,e,l),V=!0},p(e,[l]){const P={};l&8&&(P.time=e[3]),t.$set(P),e[2].length!==0?o?(o.p(e,l),l&4&&j(o,1)):(o=F(e),o.c(),j(o,1),o.m(f,null)):o&&(te(),D(o,1,1,()=>{o=null}),re()),(!V||l&3&&g!==(g=""+((e[0]||e[1]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center")))&&M(f,"class",g);const k={};l&1&&(k.visible=e[0]),l&64&&(k.messages=e[6]),m.$set(k);const h={};l&2&&(h.visible=e[1]),l&4&&(h.users=e[2]),b.$set(h)},i(e){V||(j(t.$$.fragment,e),j(o),j(m.$$.fragment,e),j(b.$$.fragment,e),V=!0)},o(e){D(t.$$.fragment,e),D(o),D(m.$$.fragment,e),D(b.$$.fragment,e),V=!1},d(e){w(c),w(s),w(r),e&&w(a),e&&w(f),L(t),o&&o.d(),e&&w(T),L(m,e),e&&w(C),L(b,e)}}}function ue(n,c,s){let r=!1,_=!1,a=[],f=0,t=[],p=[],g=[],T,m="";return ae(async()=>{const U=(await W(()=>import("../chunks/peerjs.min-0b116e46.js").then(function(i){return i.p}),["chunks/peerjs.min-0b116e46.js","chunks/vendor-d517c024.js","assets/vendor-b8c56e4e.css"])).default;s(8,m="DeathGuard12");let S=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});s(2,a=[{username:m,stream:S}]);let E=new URL(window.location.href),v=new U(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),K=(i,d="")=>{let u=v.call(i,S,{metadata:{username:m}});return s(4,t=[...t,u.peer]),s(5,p=[...p,u]),u.on("stream",H=>{a.map(Q=>Q.stream.id).includes(H.id)||s(2,a=[...a,{username:d,stream:H}])}),u},z=i=>{s(2,a=a.filter((d,u)=>t[u]!=i)),s(4,t=t.filter(d=>d!=i)),s(5,p=p.filter(d=>d.peer!=i))};v.on("open",i=>{s(4,t=[i]),K(E.searchParams.get("room"));let d=v.connect(E.searchParams.get("room"),{metadata:{username:m}});d.on("data",u=>{switch(u.type){case"connect":K(u.data.peerId,u.data.username);break;case"disconnect":z(u.data.peerId);break;case"username":s(2,a[1].username=u.data.username,a);break;case"message":s(6,g=[...g,{author:u.data.author,message:u.data.message,id:u.data.id,me:!1}]);break}}),d.on("close",()=>{z(d.peer)}),window.onunload=window.onbeforeunload=()=>{d.close()},s(7,T=d),setInterval(()=>s(3,f++,f),1e3)}),v.on("call",i=>{s(4,t=[...t,i.peer]),s(5,p=[...p,i]),i.answer(S),i.on("stream",d=>{a.map(u=>u.stream.id).includes(d.id)||s(2,a=[...a,{username:i.metadata.username,stream:d}])})}),v.on("connection",i=>i.close())}),[r,_,a,f,t,p,g,T,m,()=>a[0].stream.getVideoTracks().forEach(h=>h.enabled=!h.enabled),()=>a[0].stream.getAudioTracks().forEach(h=>h.enabled=!h.enabled),async h=>{let S=(h.detail.source==me.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];a[0].stream.getVideoTracks().forEach(E=>{E.stop(),a[0].stream.removeTrack(E)}),a[0].stream.addTrack(S),p.forEach(E=>E.peerConnection.getSenders().filter(v=>v.track.kind=="video").forEach(v=>v.replaceTrack(S)))},()=>{s(0,r=!r),s(1,_=!1)},()=>{s(1,_=!_),s(0,r=!1)},()=>s(0,r=!1),h=>{T.send({type:"message",data:{message:h.detail.message}}),s(6,g=[...g,{author:m,message:h.detail.message,id:t[0],me:!0}])},()=>s(1,_=!1)]}class _e extends X{constructor(c){super();Y(this,c,ue,ie,Z,{})}}export{_e as default};
