import{b as he,_ as xe}from"../chunks/paths-16c013c9.js";import{S as Ee,i as ye,s as ke,j as pe,m as ve,o as _e,x as L,u as W,v as ge,e as o,t as G,k as $,J as Ie,c,a as m,g as U,d as l,n as T,b as r,K as De,H as t,f as we,w as $e,A as Te,r as Ve}from"../chunks/vendor-fab53af6.js";import{N as Se,G as je,S as Pe}from"../chunks/Navbar-f668013f.js";function be(y){let i,d;return i=new je({props:{streams:y[0]}}),{c(){pe(i.$$.fragment)},l(a){ve(i.$$.fragment,a)},m(a,h){_e(i,a,h),d=!0},p(a,h){const b={};h&1&&(b.streams=a[0]),i.$set(b)},i(a){d||(L(i.$$.fragment,a),d=!0)},o(a){W(i.$$.fragment,a),d=!1},d(a){ge(i,a)}}}function He(y){let i,d,a,h,b,f,k,_,O,g,p,w,x,v,I,e,s,S,X,D,j,Y,Z,P,H,ee,te,N,q,ae,re,V,C,se,M,le,z;_=new Se({props:{time:y[1]}}),_.$on("videoswitch",y[3]),_.$on("muteswitch",y[4]),_.$on("sourceswitch",y[5]);let n=y[0].length!==0&&be(y);return{c(){i=o("link"),d=o("link"),a=o("script"),h=G("let parcelRequire;"),b=$(),f=o("div"),k=o("div"),pe(_.$$.fragment),O=$(),n&&n.c(),g=$(),p=o("div"),w=o("h1"),x=G("Chat"),v=$(),I=o("div"),e=o("div"),s=o("img"),X=$(),D=o("div"),j=o("p"),Y=G("death guard"),Z=$(),P=o("div"),H=o("p"),ee=G("Hello!"),te=$(),N=o("div"),q=o("p"),ae=G("How are you?"),re=$(),V=o("div"),C=o("input"),se=$(),M=o("button"),le=G("Send"),this.h()},l(u){const E=Ie('[data-svelte="svelte-tu3wcf"]',document.head);i=c(E,"LINK",{rel:!0,href:!0}),d=c(E,"LINK",{rel:!0,href:!0}),a=c(E,"SCRIPT",{});var K=m(a);h=U(K,"let parcelRequire;"),K.forEach(l),E.forEach(l),b=T(u),f=c(u,"DIV",{class:!0});var B=m(f);k=c(B,"DIV",{class:!0});var J=m(k);ve(_.$$.fragment,J),O=T(J),n&&n.l(J),J.forEach(l),g=T(B),p=c(B,"DIV",{class:!0});var R=m(p);w=c(R,"H1",{class:!0});var ne=m(w);x=U(ne,"Chat"),ne.forEach(l),v=T(R),I=c(R,"DIV",{class:!0});var oe=m(I);e=c(oe,"DIV",{class:!0});var F=m(e);s=c(F,"IMG",{src:!0,alt:!0,class:!0}),X=T(F),D=c(F,"DIV",{class:!0});var A=m(D);j=c(A,"P",{class:!0});var ce=m(j);Y=U(ce,"death guard"),ce.forEach(l),Z=T(A),P=c(A,"DIV",{class:!0});var ie=m(P);H=c(ie,"P",{class:!0});var de=m(H);ee=U(de,"Hello!"),de.forEach(l),ie.forEach(l),te=T(A),N=c(A,"DIV",{class:!0});var ue=m(N);q=c(ue,"P",{class:!0});var fe=m(q);ae=U(fe,"How are you?"),fe.forEach(l),ue.forEach(l),A.forEach(l),F.forEach(l),oe.forEach(l),re=T(R),V=c(R,"DIV",{class:!0});var Q=m(V);C=c(Q,"INPUT",{type:!0,class:!0,placeholder:!0}),se=T(Q),M=c(Q,"BUTTON",{class:!0});var me=m(M);le=U(me,"Send"),me.forEach(l),Q.forEach(l),R.forEach(l),B.forEach(l),this.h()},h(){r(i,"rel","icon"),r(i,"href",""+(he+"/favicon.png")),r(d,"rel","manifest"),r(d,"href",""+(he+"/manifest.json")),document.title="Home",r(k,"class","flex flex-col h-screen w-screen items-center"),r(w,"class","text-3xl text-white font-semibold mb-3"),De(s.src,S="https://avatars.dicebear.com/api/initials/death guard.svg")||r(s,"src",S),r(s,"alt","death guard"),r(s,"class","rounded-md w-12 h-12 mt-auto"),r(j,"class","text-gray-400 text-xs"),r(H,"class",""),r(P,"class","flex items-center bg-gray-600 text-white rounded-b-md rounded-tr-md flex-1 px-2 py-2"),r(q,"class",""),r(N,"class","flex items-center bg-gray-600 text-white rounded-b-md rounded-tr-md flex-1 px-2 py-2"),r(D,"class","flex flex-col flex-1 gap-1"),r(e,"class","flex gap-2"),r(I,"class","h-auto flex-1"),r(C,"type","text"),r(C,"class","w-full bg-gray-700 text-white focus:outline-none h-9 px-4 rounded-md"),r(C,"placeholder","Aa"),r(M,"class","text-white bg-blue-600 px-4 rounded-md"),r(V,"class","flex gap-2"),r(p,"class","flex flex-col w-1/3 h-screen bg-gray-800 border-l-2 border-gray-700 px-4 pt-3 pb-8"),r(f,"class","flex w-screen")},m(u,E){t(document.head,i),t(document.head,d),t(document.head,a),t(a,h),we(u,b,E),we(u,f,E),t(f,k),_e(_,k,null),t(k,O),n&&n.m(k,null),t(f,g),t(f,p),t(p,w),t(w,x),t(p,v),t(p,I),t(I,e),t(e,s),t(e,X),t(e,D),t(D,j),t(j,Y),t(D,Z),t(D,P),t(P,H),t(H,ee),t(D,te),t(D,N),t(N,q),t(q,ae),t(p,re),t(p,V),t(V,C),t(V,se),t(V,M),t(M,le),z=!0},p(u,[E]){const K={};E&2&&(K.time=u[1]),_.$set(K),u[0].length!==0?n?(n.p(u,E),E&1&&L(n,1)):(n=be(u),n.c(),L(n,1),n.m(k,null)):n&&(Ve(),W(n,1,1,()=>{n=null}),$e())},i(u){z||(L(_.$$.fragment,u),L(n),z=!0)},o(u){W(_.$$.fragment,u),W(n),z=!1},d(u){l(i),l(d),l(a),u&&l(b),u&&l(f),ge(_),n&&n.d()}}}function Ne(y,i,d){let a=[],h=[],b=0,f=[];return Te(async()=>{const p=(await xe(()=>import("../chunks/peerjs.min-873ec715.js").then(function(e){return e.p}),["chunks/peerjs.min-873ec715.js","chunks/vendor-fab53af6.js","assets/vendor-b8c56e4e.css"])).default;let w="DeathGuard12",x=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});d(0,a=[{username:w,stream:x}]);let v=[],I=new p(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}});I.on("open",e=>{console.log(e),h=[e],setInterval(()=>d(1,b++,b),1e3)}),I.on("call",e=>{h=[...h,e.peer],d(2,f=[...f,e]),e.answer(x),e.on("stream",s=>{a.map(S=>S.stream.id).includes(s.id)||d(0,a=[...a,{username:e.metadata.username,stream:s}])})}),I.on("connection",e=>{e.on("open",()=>{v.forEach(s=>{s.send({type:"connect",data:{peerId:e.peer,username:e.metadata.username}})}),e.send({type:"username",data:{username:w}}),v.push(e)}),e.on("close",()=>{v=v.filter(s=>s!=e),d(0,a=a.filter((s,S)=>h[S]!=e.peer)),h=h.filter(s=>s!=e.peer),d(2,f=f.filter(s=>s.peer!=e.peer)),v.forEach(s=>{s.send({type:"disconnect",data:{peerId:e.peer}})})}),window.onunload=window.onbeforeunload=()=>{e.close()}})}),[a,b,f,()=>a[0].stream.getVideoTracks().forEach(g=>g.enabled=!g.enabled),()=>a[0].stream.getAudioTracks().forEach(g=>g.enabled=!g.enabled),async g=>{let w=(g.detail.source==Pe.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];a[0].stream.getVideoTracks().forEach(x=>{x.stop(),a[0].stream.removeTrack(x)}),a[0].stream.addTrack(w),f.forEach(x=>x.peerConnection.getSenders().filter(v=>v.track.kind=="video").forEach(v=>v.replaceTrack(w)))}]}class Re extends Ee{constructor(i){super();ye(this,i,Ne,He,ke,{})}}export{Re as default};
