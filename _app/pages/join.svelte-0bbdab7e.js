import{b as z,_ as B}from"../chunks/paths-16c013c9.js";import{S as F,i as Q,s as W,j as I,m as R,o as q,x as P,u as V,v as L,e as D,t as X,k as M,J as Y,c as y,a as H,g as Z,d as b,n as N,b as S,H as C,f as A,w as x,A as ee,r as se}from"../chunks/vendor-4dd1f186.js";import{N as te,C as ae,G as re,S as ne}from"../chunks/Chat-82a128d8.js";function O(i){let l,e;return l=new re({props:{streams:i[1],sidePanelVisible:i[0]}}),{c(){I(l.$$.fragment)},l(a){R(l.$$.fragment,a)},m(a,t){q(l,a,t),e=!0},p(a,t){const h={};t&2&&(h.streams=a[1]),t&1&&(h.sidePanelVisible=a[0]),l.$set(h)},i(a){e||(P(l.$$.fragment,a),e=!0)},o(a){V(l.$$.fragment,a),e=!1},d(a){L(l,a)}}}function oe(i){let l,e,a,t,h,r,n,g,k,p,_,T;n=new te({props:{time:i[2]}}),n.$on("videoswitch",i[8]),n.$on("muteswitch",i[9]),n.$on("sourceswitch",i[10]),n.$on("chatswitch",i[11]);let o=i[1].length!==0&&O(i);return _=new ae({props:{visible:i[0],messages:i[5]}}),_.$on("close",i[12]),_.$on("messagesend",i[13]),{c(){l=D("link"),e=D("link"),a=D("script"),t=X("let parcelRequire;"),h=M(),r=D("div"),I(n.$$.fragment),g=M(),o&&o.c(),p=M(),I(_.$$.fragment),this.h()},l(s){const m=Y('[data-svelte="svelte-uncxtc"]',document.head);l=y(m,"LINK",{rel:!0,href:!0}),e=y(m,"LINK",{rel:!0,href:!0}),a=y(m,"SCRIPT",{});var E=H(a);t=Z(E,"let parcelRequire;"),E.forEach(b),m.forEach(b),h=N(s),r=y(s,"DIV",{class:!0});var c=H(r);R(n.$$.fragment,c),g=N(c),o&&o.l(c),c.forEach(b),p=N(s),R(_.$$.fragment,s),this.h()},h(){S(l,"rel","icon"),S(l,"href",""+(z+"/favicon.png")),S(e,"rel","manifest"),S(e,"href",""+(z+"/manifest.json")),document.title="Join",S(r,"class",k=""+((i[0]?"hidden":"flex")+" md:flex flex-col h-screen w-screen items-center"))},m(s,m){C(document.head,l),C(document.head,e),C(document.head,a),C(a,t),A(s,h,m),A(s,r,m),q(n,r,null),C(r,g),o&&o.m(r,null),A(s,p,m),q(_,s,m),T=!0},p(s,[m]){const E={};m&4&&(E.time=s[2]),n.$set(E),s[1].length!==0?o?(o.p(s,m),m&2&&P(o,1)):(o=O(s),o.c(),P(o,1),o.m(r,null)):o&&(se(),V(o,1,1,()=>{o=null}),x()),(!T||m&1&&k!==(k=""+((s[0]?"hidden":"flex")+" md:flex flex-col h-screen w-screen items-center")))&&S(r,"class",k);const c={};m&1&&(c.visible=s[0]),m&32&&(c.messages=s[5]),_.$set(c)},i(s){T||(P(n.$$.fragment,s),P(o),P(_.$$.fragment,s),T=!0)},o(s){V(n.$$.fragment,s),V(o),V(_.$$.fragment,s),T=!1},d(s){b(l),b(e),b(a),s&&b(h),s&&b(r),L(n),o&&o.d(),s&&b(p),L(_,s)}}}function ce(i,l,e){let a=!1,t=[],h=0,r=[],n=[],g=[],k,p="";return ee(async()=>{const G=(await B(()=>import("../chunks/peerjs.min-140f3233.js").then(function(u){return u.p}),["chunks/peerjs.min-140f3233.js","chunks/vendor-4dd1f186.js","assets/vendor-b8c56e4e.css"])).default;e(7,p="DeathGuard12");let j=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});e(1,t=[{username:p,stream:j}]);let v=new URL(window.location.href),w=new G(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),J=(u,f="")=>{let d=w.call(u,j,{metadata:{username:p}});return e(3,r=[...r,d.peer]),e(4,n=[...n,d]),d.on("stream",K=>{t.map($=>$.stream.id).includes(K.id)||e(1,t=[...t,{username:f,stream:K}])}),d},U=u=>{e(1,t=t.filter((f,d)=>r[d]!=u)),e(3,r=r.filter(f=>f!=u)),e(4,n=n.filter(f=>f.peer!=u))};w.on("open",u=>{e(3,r=[u]),J(v.searchParams.get("room"));let f=w.connect(v.searchParams.get("room"),{metadata:{username:p}});f.on("data",d=>{switch(d.type){case"connect":J(d.data.peerId,d.data.username);break;case"disconnect":U(d.data.peerId);break;case"username":e(1,t[1].username=d.data.username,t);break;case"message":e(5,g=[...g,{author:d.data.author,message:d.data.message,id:d.data.id,me:!1}]);break}}),f.on("close",()=>{U(f.peer)}),window.onunload=window.onbeforeunload=()=>{f.close()},e(6,k=f),setInterval(()=>e(2,h++,h),1e3)}),w.on("call",u=>{e(3,r=[...r,u.peer]),e(4,n=[...n,u]),u.answer(j),u.on("stream",f=>{t.map(d=>d.stream.id).includes(f.id)||e(1,t=[...t,{username:u.metadata.username,stream:f}])})}),w.on("connection",u=>u.close())}),[a,t,h,r,n,g,k,p,()=>t[0].stream.getVideoTracks().forEach(c=>c.enabled=!c.enabled),()=>t[0].stream.getAudioTracks().forEach(c=>c.enabled=!c.enabled),async c=>{let j=(c.detail.source==ne.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];t[0].stream.getVideoTracks().forEach(v=>{v.stop(),t[0].stream.removeTrack(v)}),t[0].stream.addTrack(j),n.forEach(v=>v.peerConnection.getSenders().filter(w=>w.track.kind=="video").forEach(w=>w.replaceTrack(j)))},()=>e(0,a=!a),()=>e(0,a=!1),c=>{k.send({type:"message",data:{message:c.detail.message}}),e(5,g=[...g,{author:p,message:c.detail.message,id:r[0],me:!0}])}]}class ue extends F{constructor(l){super();Q(this,l,ce,oe,W,{})}}export{ue as default};
