import{b as G,_ as H}from"../chunks/paths-16c013c9.js";import{S as K,i as U,s as z,j as P,m as C,o as R,x as y,u as $,v as q,e as V,t as J,k as M,J as B,c as D,a as L,g as F,d as w,n as N,b as T,H as I,f as A,w as Q,A as W,r as X}from"../chunks/vendor-4dd1f186.js";import{N as Y,C as Z,G as x,S as ee}from"../chunks/Chat-82a128d8.js";function O(c){let i,t;return i=new x({props:{streams:c[0],sidePanelVisible:c[6]}}),{c(){P(i.$$.fragment)},l(e){C(i.$$.fragment,e)},m(e,l){R(i,e,l),t=!0},p(e,l){const f={};l&1&&(f.streams=e[0]),l&64&&(f.sidePanelVisible=e[6]),i.$set(f)},i(e){t||(y(i.$$.fragment,e),t=!0)},o(e){$(i.$$.fragment,e),t=!1},d(e){q(i,e)}}}function se(c){let i,t,e,l,f,m,r,g,_,h,p,b;r=new Y({props:{time:c[2]}}),r.$on("videoswitch",c[8]),r.$on("muteswitch",c[9]),r.$on("sourceswitch",c[10]),r.$on("chatswitch",c[11]);let n=c[0].length!==0&&O(c);return p=new Z({props:{visible:c[6],messages:c[5]}}),p.$on("close",c[12]),p.$on("messagesend",c[13]),{c(){i=V("link"),t=V("link"),e=V("script"),l=J("let parcelRequire;"),f=M(),m=V("div"),P(r.$$.fragment),g=M(),n&&n.c(),h=M(),P(p.$$.fragment),this.h()},l(a){const u=B('[data-svelte="svelte-tu3wcf"]',document.head);i=D(u,"LINK",{rel:!0,href:!0}),t=D(u,"LINK",{rel:!0,href:!0}),e=D(u,"SCRIPT",{});var k=L(e);l=F(k,"let parcelRequire;"),k.forEach(w),u.forEach(w),f=N(a),m=D(a,"DIV",{class:!0});var o=L(m);C(r.$$.fragment,o),g=N(o),n&&n.l(o),o.forEach(w),h=N(a),C(p.$$.fragment,a),this.h()},h(){T(i,"rel","icon"),T(i,"href",""+(G+"/favicon.png")),T(t,"rel","manifest"),T(t,"href",""+(G+"/manifest.json")),document.title="Home",T(m,"class",_=""+((c[6]?"hidden":"flex")+" md:flex flex-col h-screen w-screen items-center"))},m(a,u){I(document.head,i),I(document.head,t),I(document.head,e),I(e,l),A(a,f,u),A(a,m,u),R(r,m,null),I(m,g),n&&n.m(m,null),A(a,h,u),R(p,a,u),b=!0},p(a,[u]){const k={};u&4&&(k.time=a[2]),r.$set(k),a[0].length!==0?n?(n.p(a,u),u&1&&y(n,1)):(n=O(a),n.c(),y(n,1),n.m(m,null)):n&&(X(),$(n,1,1,()=>{n=null}),Q()),(!b||u&64&&_!==(_=""+((a[6]?"hidden":"flex")+" md:flex flex-col h-screen w-screen items-center")))&&T(m,"class",_);const o={};u&64&&(o.visible=a[6]),u&32&&(o.messages=a[5]),p.$set(o)},i(a){b||(y(r.$$.fragment,a),y(n),y(p.$$.fragment,a),b=!0)},o(a){$(r.$$.fragment,a),$(n),$(p.$$.fragment,a),b=!1},d(a){w(i),w(t),w(e),a&&w(f),a&&w(m),q(r),n&&n.d(),a&&w(h),q(p,a)}}}function ae(c,i,t){let e=[],l=[],f=0,m=[],r=[],g=[],_=!1,h="";return W(async()=>{const S=(await H(()=>import("../chunks/peerjs.min-140f3233.js").then(function(s){return s.p}),["chunks/peerjs.min-140f3233.js","chunks/vendor-4dd1f186.js","assets/vendor-b8c56e4e.css"])).default;t(7,h="DeathGuard12");let j=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});t(0,e=[{username:h,stream:j}]);let v=new S(void 0,{config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}});v.on("open",s=>{console.log(s),t(1,l=[s]),setInterval(()=>t(2,f++,f),1e3)}),v.on("call",s=>{t(1,l=[...l,s.peer]),t(3,m=[...m,s]),s.answer(j),s.on("stream",d=>{e.map(E=>E.stream.id).includes(d.id)||t(0,e=[...e,{username:s.metadata.username,stream:d}])})}),v.on("connection",s=>{s.on("open",()=>{r.forEach(d=>{d.send({type:"connect",data:{peerId:s.peer,username:s.metadata.username}})}),s.send({type:"username",data:{username:h}}),r.push(s)}),s.on("close",()=>{t(4,r=r.filter(d=>d!=s)),t(0,e=e.filter((d,E)=>l[E]!=s.peer)),t(1,l=l.filter(d=>d!=s.peer)),t(3,m=m.filter(d=>d.peer!=s.peer)),r.forEach(d=>{d.send({type:"disconnect",data:{peerId:s.peer}})})}),s.on("data",d=>{switch(d.type){case"message":r.forEach(E=>{E.peer!=s.peer&&E.send({type:"message",data:{author:e[r.indexOf(s)].username,message:d.data.message,id:s.peer}})}),t(5,g=[...g,{author:e[r.indexOf(s)].username,message:d.data.message,id:s.peer,me:!1}]);break}}),window.onunload=window.onbeforeunload=()=>{s.close()}})}),[e,l,f,m,r,g,_,h,()=>e[0].stream.getVideoTracks().forEach(o=>o.enabled=!o.enabled),()=>e[0].stream.getAudioTracks().forEach(o=>o.enabled=!o.enabled),async o=>{let j=(o.detail.source==ee.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];e[0].stream.getVideoTracks().forEach(v=>{v.stop(),e[0].stream.removeTrack(v)}),e[0].stream.addTrack(j),m.forEach(v=>v.peerConnection.getSenders().filter(s=>s.track.kind=="video").forEach(s=>s.replaceTrack(j)))},()=>t(6,_=!_),()=>t(6,_=!1),o=>{r.forEach(S=>{S.send({type:"message",data:{author:h,message:o.detail.message,id:l[0]}})}),t(5,g=[...g,{author:h,message:o.detail.message,id:l[0],me:!0}])}]}class oe extends K{constructor(i){super();U(this,i,ae,se,z,{})}}export{oe as default};
