import{b as A,_ as K}from"../chunks/paths-16c013c9.js";import{S as H,i as O,s as z,j,m as D,o as I,x as b,u as E,v as L,e as R,t as B,k as q,L as F,c as C,a as U,g as Q,d as p,n as N,b as M,H as V,f as T,w as W,A as X,r as Y}from"../chunks/vendor-c12c101d.js";import{N as Z,C as x,M as ee,G as se,S as te}from"../chunks/Members-fd8d9494.js";function y(a){let o,r;return o=new se({props:{streams:a[3],sidePanelVisible:a[1]||a[2]}}),{c(){j(o.$$.fragment)},l(s){D(o.$$.fragment,s)},m(s,c){I(o,s,c),r=!0},p(s,c){const f={};c&8&&(f.streams=s[3]),c&6&&(f.sidePanelVisible=s[1]||s[2]),o.$set(f)},i(s){r||(b(o.$$.fragment,s),r=!0)},o(s){E(o.$$.fragment,s),r=!1},d(s){L(o,s)}}}function re(a){let o,r,s,c,f,t,i,w,g,P,h,S,_,v;i=new Z({props:{time:a[4],peer:!0}}),i.$on("videoswitch",a[6]),i.$on("muteswitch",a[7]),i.$on("sourceswitch",a[8]),i.$on("chatswitch",a[9]),i.$on("membersswitch",a[10]);let n=a[3].length!==0&&y(a);return h=new x({props:{visible:a[1],messages:a[5]}}),h.$on("close",a[11]),h.$on("messagesend",a[12]),_=new ee({props:{visible:a[2],users:a[3]}}),_.$on("close",a[13]),{c(){o=R("link"),r=R("link"),s=R("script"),c=B("let parcelRequire;"),f=q(),t=R("div"),j(i.$$.fragment),w=q(),n&&n.c(),P=q(),j(h.$$.fragment),S=q(),j(_.$$.fragment),this.h()},l(e){const l=F('[data-svelte="svelte-uncxtc"]',document.head);o=C(l,"LINK",{rel:!0,href:!0}),r=C(l,"LINK",{rel:!0,href:!0}),s=C(l,"SCRIPT",{});var m=U(s);c=Q(m,"let parcelRequire;"),m.forEach(p),l.forEach(p),f=N(e),t=C(e,"DIV",{class:!0});var u=U(t);D(i.$$.fragment,u),w=N(u),n&&n.l(u),u.forEach(p),P=N(e),D(h.$$.fragment,e),S=N(e),D(_.$$.fragment,e),this.h()},h(){M(o,"rel","icon"),M(o,"href",""+(A+"/favicon.png")),M(r,"rel","manifest"),M(r,"href",""+(A+"/manifest.json")),document.title="Join",M(t,"class",g=""+((a[1]||a[2]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center"))},m(e,l){V(document.head,o),V(document.head,r),V(document.head,s),V(s,c),T(e,f,l),T(e,t,l),I(i,t,null),V(t,w),n&&n.m(t,null),T(e,P,l),I(h,e,l),T(e,S,l),I(_,e,l),v=!0},p(e,[l]){const m={};l&16&&(m.time=e[4]),i.$set(m),e[3].length!==0?n?(n.p(e,l),l&8&&b(n,1)):(n=y(e),n.c(),b(n,1),n.m(t,null)):n&&(Y(),E(n,1,1,()=>{n=null}),W()),(!v||l&6&&g!==(g=""+((e[1]||e[2]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center")))&&M(t,"class",g);const u={};l&2&&(u.visible=e[1]),l&32&&(u.messages=e[5]),h.$set(u);const $={};l&4&&($.visible=e[2]),l&8&&($.users=e[3]),_.$set($)},i(e){v||(b(i.$$.fragment,e),b(n),b(h.$$.fragment,e),b(_.$$.fragment,e),v=!0)},o(e){E(i.$$.fragment,e),E(n),E(h.$$.fragment,e),E(_.$$.fragment,e),v=!1},d(e){p(o),p(r),p(s),e&&p(f),e&&p(t),L(i),n&&n.d(),e&&p(P),L(h,e),e&&p(S),L(_,e)}}}function ae(a,o,r){let s,c=!1,f=!1,t=[],i=0,w=[],g="";return X(async()=>{const u=(await K(()=>import("../chunks/Peer-86cfd71f.js"),["chunks/Peer-86cfd71f.js","chunks/index-67a36a3b.js","chunks/vendor-c12c101d.js","assets/vendor-b8c56e4e.css"])).default;g=window.prompt("Enter username: ");let $=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),G=new URL(window.location.href);r(0,s=new u(g,$,G.searchParams.get("room"))),s.on("peer",d=>{t.map(k=>k.stream.id).includes(d.stream.id)||r(3,t=[...t,d])}),s.on("open",d=>{r(3,t=[{id:d,username:g,stream:$,video:!0,audio:!0}]),setInterval(()=>r(4,i++,i),1e3)}),s.on("disconnect",d=>{r(3,t=t.filter(k=>k.id!=d))}),s.on("message",d=>{r(5,w=[...w,d])}),s.on("toggle",d=>{let k=t.find(J=>J.id==d.id);k.video=d.video,k.audio=d.audio,r(3,t)})}),[s,c,f,t,i,w,()=>{t[0].stream.getVideoTracks().forEach(m=>m.enabled=!m.enabled),r(3,t[0].video=!t[0].video,t),s.toggleMedia(!s.videoEnabled)},()=>{t[0].stream.getAudioTracks().forEach(m=>m.enabled=!m.enabled),r(3,t[0].audio=!t[0].audio,t),s.toggleMedia(void 0,!s.audioEnabled)},async m=>{let u=m.detail.source==te.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0});s.replaceStream(u)},()=>{r(1,c=!c),r(2,f=!1)},()=>{r(2,f=!f),r(1,c=!1)},()=>r(1,c=!1),m=>s.send(m.detail.message),()=>r(2,f=!1)]}class ie extends H{constructor(o){super();O(this,o,ae,re,z,{})}}export{ie as default};
