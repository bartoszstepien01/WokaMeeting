import{_ as H}from"../chunks/preload-helper.41c905a7.js";import{S as Q,i as X,s as Y,k as A,q as Z,a as I,y as R,L as x,l as G,m as K,r as ee,h as g,c as N,z as q,n as V,G as D,b as L,A as C,g as b,d as k,f as U,B as T,o as se,w as ne,M as re,N as ae,v as z}from"../chunks/index.5227cc00.js";import{b as B}from"../chunks/paths.905c24af.js";import{N as te,C as ie,M as oe,J as le,G as me,S as fe}from"../chunks/JoinPopup.de206de2.js";function O(a){let t,r,s;function d(n){a[8](n)}let c={};return a[7]!==void 0&&(c.promise=a[7]),t=new le({props:c}),ne.push(()=>re(t,"promise",d)),{c(){R(t.$$.fragment)},l(n){q(t.$$.fragment,n)},m(n,f){C(t,n,f),s=!0},p(n,f){const m={};!r&&f&128&&(r=!0,m.promise=n[7],ae(()=>r=!1)),t.$set(m)},i(n){s||(b(t.$$.fragment,n),s=!0)},o(n){k(t.$$.fragment,n),s=!1},d(n){T(t,n)}}}function W(a){let t,r;return t=new me({props:{streams:a[3],sidePanelVisible:a[1]||a[2]}}),{c(){R(t.$$.fragment)},l(s){q(t.$$.fragment,s)},m(s,d){C(t,s,d),r=!0},p(s,d){const c={};d&8&&(c.streams=s[3]),d&6&&(c.sidePanelVisible=s[1]||s[2]),t.$set(c)},i(s){r||(b(t.$$.fragment,s),r=!0)},o(s){k(t.$$.fragment,s),r=!1},d(s){T(t,s)}}}function ue(a){let t,r,s,d,c,n,f,m,M,v,E,h,j,w,P,o=a[6]==null&&O(a);m=new te({props:{time:a[4],peer:!0}}),m.$on("videoswitch",a[9]),m.$on("muteswitch",a[10]),m.$on("sourceswitch",a[11]),m.$on("chatswitch",a[12]),m.$on("membersswitch",a[13]);let l=a[3].length!==0&&W(a);return h=new ie({props:{visible:a[1],messages:a[5]}}),h.$on("close",a[14]),h.$on("messagesend",a[15]),w=new oe({props:{visible:a[2],users:a[3]}}),w.$on("close",a[16]),{c(){t=A("link"),r=A("link"),s=A("script"),d=Z("let parcelRequire;"),c=I(),o&&o.c(),n=I(),f=A("div"),R(m.$$.fragment),M=I(),l&&l.c(),E=I(),R(h.$$.fragment),j=I(),R(w.$$.fragment),this.h()},l(e){const i=x("svelte-dvkar3",document.head);t=G(i,"LINK",{rel:!0,href:!0}),r=G(i,"LINK",{rel:!0,href:!0}),s=G(i,"SCRIPT",{});var u=K(s);d=ee(u,"let parcelRequire;"),u.forEach(g),i.forEach(g),c=N(e),o&&o.l(e),n=N(e),f=G(e,"DIV",{class:!0});var p=K(f);q(m.$$.fragment,p),M=N(p),l&&l.l(p),p.forEach(g),E=N(e),q(h.$$.fragment,e),j=N(e),q(w.$$.fragment,e),this.h()},h(){V(t,"rel","icon"),V(t,"href",B+"/favicon.png"),V(r,"rel","manifest"),V(r,"href",B+"/manifest.json"),document.title="WokaMeeting",V(f,"class",v=(a[1]||a[2]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center")},m(e,i){D(document.head,t),D(document.head,r),D(document.head,s),D(s,d),L(e,c,i),o&&o.m(e,i),L(e,n,i),L(e,f,i),C(m,f,null),D(f,M),l&&l.m(f,null),L(e,E,i),C(h,e,i),L(e,j,i),C(w,e,i),P=!0},p(e,[i]){e[6]==null?o?(o.p(e,i),i&64&&b(o,1)):(o=O(e),o.c(),b(o,1),o.m(n.parentNode,n)):o&&(z(),k(o,1,1,()=>{o=null}),U());const u={};i&16&&(u.time=e[4]),m.$set(u),e[3].length!==0?l?(l.p(e,i),i&8&&b(l,1)):(l=W(e),l.c(),b(l,1),l.m(f,null)):l&&(z(),k(l,1,1,()=>{l=null}),U()),(!P||i&6&&v!==(v=(e[1]||e[2]?"hidden":"flex")+" md:flex flex-col h-screen w-full items-center"))&&V(f,"class",v);const p={};i&2&&(p.visible=e[1]),i&32&&(p.messages=e[5]),h.$set(p);const $={};i&4&&($.visible=e[2]),i&8&&($.users=e[3]),w.$set($)},i(e){P||(b(o),b(m.$$.fragment,e),b(l),b(h.$$.fragment,e),b(w.$$.fragment,e),P=!0)},o(e){k(o),k(m.$$.fragment,e),k(l),k(h.$$.fragment,e),k(w.$$.fragment,e),P=!1},d(e){g(t),g(r),g(s),e&&g(c),o&&o.d(e),e&&g(n),e&&g(f),T(m),l&&l.d(),e&&g(E),T(h,e),e&&g(j),T(w,e)}}}function ce(a,t,r){let s,d=!1,c=!1,n=[],f=0,m=[],M,v;se(async()=>{const p=(await H(()=>import("../chunks/Peer.90f8caac.js"),["../chunks/Peer.90f8caac.js","../chunks/index.fda93153.js"],import.meta.url)).default;let $=await v;r(6,M=$.username);let J=$.stream,y=new URL(window.location.href);r(0,s=new p(M,J,y.searchParams.get("room"))),s.toggleMedia($.video,$.audio),s.on("peer",_=>{n.map(S=>S.stream.id).includes(_.stream.id)||r(3,n=[...n,_])}),s.on("open",_=>{r(3,n=[{id:_,username:M,stream:J,video:$.video,audio:$.audio}]),setInterval(()=>r(4,f++,f),1e3)}),s.on("disconnect",_=>{r(3,n=n.filter(S=>S.id!=_))}),s.on("message",_=>{r(5,m=[...m,_])}),s.on("toggle",_=>{let S=n.find(F=>F.id==_.id);S.video=_.video,S.audio=_.audio,r(3,n)})});function E(u){v=u,r(7,v)}return[s,d,c,n,f,m,M,v,E,()=>{n[0].stream.getVideoTracks().forEach(u=>u.enabled=!u.enabled),r(3,n[0].video=!n[0].video,n),s.toggleMedia(!s.videoEnabled)},()=>{n[0].stream.getAudioTracks().forEach(u=>u.enabled=!u.enabled),r(3,n[0].audio=!n[0].audio,n),s.toggleMedia(void 0,!s.audioEnabled)},async u=>{let p=u.detail.source==fe.Screen?await navigator.mediaDevices.getDisplayMedia({video:!0}):await navigator.mediaDevices.getUserMedia({video:!0});s.replaceStream(p)},()=>{r(1,d=!d),r(2,c=!1)},()=>{r(2,c=!c),r(1,d=!1)},()=>r(1,d=!1),u=>s.send(u.detail.message),()=>r(2,c=!1)]}class ge extends Q{constructor(t){super(),X(this,t,ce,ue,Y,{})}}export{ge as component};
